# 后端接口测试计划

## 📋 测试信息

- **项目名称**：企业级AI综合管理平台
- **测试版本**：v1.0（第一版）
- **创建时间**：2026-01-15
- **测试类型**：后端接口功能测试
- **测试状态**：准备开始

---

## 🎯 测试目标

1. **功能验证**：验证所有后端接口功能是否正常
2. **接口可用性**：确保所有接口可以正常调用
3. **数据完整性**：验证数据存储和检索是否正确
4. **错误处理**：验证错误处理是否合理
5. **性能基准**：建立性能基准数据

---

## 📊 测试范围

### 已开发服务

| 服务名称 | 端口 | 测试状态 | 测试用例数 |
|---------|------|---------|-----------|
| **认证域服务** | 8001 | ⬜ 待开始 | 3 |
| **用户域服务** | 8002 | ⬜ 待开始 | 9 |
| **权限域服务** | 8003 | ⬜ 待开始 | 9 |
| **总计** | 3个服务 | ⬜ 待开始 | 21 |

### 测试接口清单

#### 1. 认证域服务（auth-service:8001）

| 接口路径 | 方法 | 功能 | 测试状态 |
|---------|------|------|---------|
| `/api/v1/auth/login` | POST | 用户登录 | ⬜ 待开始 |
| `/api/v1/auth/refresh` | POST | 刷新Token | ⬜ 待开始 |
| `/api/v1/auth/logout` | POST | 用户登出 | ⬜ 待开始 |

#### 2. 用户域服务（user-service:8002）

| 接口路径 | 方法 | 功能 | 测试状态 |
|---------|------|------|---------|
| `/api/v1/users` | POST | 创建用户 | ⬜ 待开始 |
| `/api/v1/users` | GET | 获取用户列表 | ⬜ 待开始 |
| `/api/v1/users/{id}` | GET | 获取用户详情 | ⬜ 待开始 |
| `/api/v1/users/{id}` | PUT | 更新用户 | ⬜ 待开始 |
| `/api/v1/users/{id}` | DELETE | 删除用户 | ⬜ 待开始 |
| `/api/v1/departments` | POST | 创建部门 | ⬜ 待开始 |
| `/api/v1/departments` | GET | 获取部门列表 | ⬜ 待开始 |
| `/api/v1/departments/tree` | GET | 获取部门树 | ⬜ 待开始 |
| `/api/v1/tenants` | POST | 创建租户 | ⬜ 待开始 |

#### 3. 权限域服务（permission-service:8003）

| 接口路径 | 方法 | 功能 | 测试状态 |
|---------|------|------|---------|
| `/api/v1/roles` | POST | 创建角色 | ⬜ 待开始 |
| `/api/v1/roles` | GET | 获取角色列表 | ⬜ 待开始 |
| `/api/v1/roles/{id}` | GET | 获取角色详情 | ⬜ 待开始 |
| `/api/v1/permissions` | POST | 创建权限 | ⬜ 待开始 |
| `/api/v1/permissions` | GET | 获取权限列表 | ⬜ 待开始 |
| `/api/v1/menus` | POST | 创建菜单 | ⬜ 待开始 |
| `/api/v1/menus` | GET | 获取菜单列表 | ⬜ 待开始 |
| `/api/v1/menus/tree` | GET | 获取菜单树 | ⬜ 待开始 |

---

## 🔧 测试环境

### 环境配置

| 组件 | 地址 | 状态 | 说明 |
|-----|------|------|------|
| **MySQL** | localhost:3306 | ✅ 已配置 | 数据库：mcp_platform |
| **Redis** | 127.0.0.1:6379 | ✅ 已配置 | 缓存服务 |
| **Nacos** | 127.0.0.1:18848 | ✅ 已配置 | 配置中心 |
| **RabbitMQ** | localhost:5672 | ✅ 已配置 | 消息队列 |

### 服务端口

| 服务 | 端口 | 状态 | 健康检查 |
|-----|------|------|---------|
| **认证域服务** | 8001 | ⬜ 待启动 | http://localhost:8001/health |
| **用户域服务** | 8002 | ⬜ 待启动 | http://localhost:8002/health |
| **权限域服务** | 8003 | ⬜ 待启动 | http://localhost:8003/health |

---

## 📝 测试用例

### 1. 认证域服务测试用例

#### TC-001: 用户登录

**测试步骤**：
1. 启动认证域服务
2. 发送POST请求到 `/api/v1/auth/login`
3. 请求参数：
   ```json
   {
     "username": "admin",
     "password": "123456"
   }
   ```
4. 验证响应状态码为200
5. 验证响应包含access_token和refresh_token
6. 验证响应包含用户信息

**预期结果**：
- 状态码：200
- 响应包含：access_token, refresh_token, token_type, expires_in, user_info

**实际结果**：⬜ 待测试

---

#### TC-002: 刷新Token

**测试步骤**：
1. 使用TC-001获得的refresh_token
2. 发送POST请求到 `/api/v1/auth/refresh`
3. 请求参数：
   ```json
   {
     "refresh_token": "xxx"
   }
   ```
4. 验证响应状态码为200
5. 验证响应包含新的access_token

**预期结果**：
- 状态码：200
- 响应包含：access_token, token_type, expires_in

**实际结果**：⬜ 待测试

---

#### TC-003: 用户登出

**测试步骤**：
1. 发送POST请求到 `/api/v1/auth/logout`
2. 验证响应状态码为200
3. 验证响应包含成功消息

**预期结果**：
- 状态码：200
- 响应包含：message: "登出成功"

**实际结果**：⬜ 待测试

---

### 2. 用户域服务测试用例

#### TC-004: 创建用户

**测试步骤**：
1. 启动用户域服务
2. 发送POST请求到 `/api/v1/users`
3. 请求参数：
   ```json
   {
     "username": "testuser",
     "password": "123456",
     "email": "test@example.com",
     "tenant_id": "default"
   }
   ```
4. 验证响应状态码为200
5. 验证用户创建成功

**预期结果**：
- 状态码：200
- 响应包含用户信息

**实际结果**：⬜ 待测试

---

#### TC-005: 获取用户列表

**测试步骤**：
1. 发送GET请求到 `/api/v1/users?page=1&page_size=10`
2. 验证响应状态码为200
3. 验证响应包含用户列表

**预期结果**：
- 状态码：200
- 响应包含：total, items, page, page_size

**实际结果**：⬜ 待测试

---

#### TC-006: 获取用户详情

**测试步骤**：
1. 发送GET请求到 `/api/v1/users/123`
2. 验证响应状态码为200
3. 验证响应包含用户详细信息

**预期结果**：
- 状态码：200
- 响应包含用户详细信息

**实际结果**：⬜ 待测试

---

#### TC-007: 更新用户

**测试步骤**：
1. 发送PUT请求到 `/api/v1/users/123`
2. 请求参数：
   ```json
   {
     "email": "newemail@example.com"
   }
   ```
3. 验证响应状态码为200
4. 验证用户更新成功

**预期结果**：
- 状态码：200
- 响应包含更新后的用户信息

**实际结果**：⬜ 待测试

---

#### TC-008: 删除用户

**测试步骤**：
1. 发送DELETE请求到 `/api/v1/users/123`
2. 验证响应状态码为200
3. 验证删除成功消息

**预期结果**：
- 状态码：200
- 响应包含：message: "删除成功"

**实际结果**：⬜ 待测试

---

#### TC-009: 创建部门

**测试步骤**：
1. 发送POST请求到 `/api/v1/departments`
2. 请求参数：
   ```json
   {
     "name": "技术部",
     "code": "tech",
     "tenant_id": "default"
   }
   ```
3. 验证响应状态码为200
4. 验证部门创建成功

**预期结果**：
- 状态码：200
- 响应包含部门信息

**实际结果**：⬜ 待测试

---

#### TC-010: 获取部门列表

**测试步骤**：
1. 发送GET请求到 `/api/v1/departments?page=1&page_size=10`
2. 验证响应状态码为200
3. 验证响应包含部门列表

**预期结果**：
- 状态码：200
- 响应包含：total, items, page, page_size

**实际结果**：⬜ 待测试

---

#### TC-011: 获取部门树

**测试步骤**：
1. 发送GET请求到 `/api/v1/departments/tree?tenant_id=default`
2. 验证响应状态码为200
3. 验证响应包含部门树结构

**预期结果**：
- 状态码：200
- 响应包含部门树（包含children字段）

**实际结果**：⬜ 待测试

---

#### TC-012: 创建租户

**测试步骤**：
1. 发送POST请求到 `/api/v1/tenants`
2. 请求参数：
   ```json
   {
     "name": "测试租户",
     "code": "test_tenant"
   }
   ```
3. 验证响应状态码为200
4. 验证租户创建成功

**预期结果**：
- 状态码：200
- 响应包含租户信息

**实际结果**：⬜ 待测试

---

### 3. 权限域服务测试用例

#### TC-013: 创建角色

**测试步骤**：
1. 启动权限域服务
2. 发送POST请求到 `/api/v1/roles`
3. 请求参数：
   ```json
   {
     "name": "管理员",
     "code": "admin",
     "tenant_id": "default"
   }
   ```
4. 验证响应状态码为200
5. 验证角色创建成功

**预期结果**：
- 状态码：200
- 响应包含角色信息

**实际结果**：⬜ 待测试

---

#### TC-014: 获取角色列表

**测试步骤**：
1. 发送GET请求到 `/api/v1/roles?page=1&page_size=10`
2. 验证响应状态码为200
3. 验证响应包含角色列表

**预期结果**：
- 状态码：200
- 响应包含：total, items, page, page_size

**实际结果**：⬜ 待测试

---

#### TC-015: 获取角色详情

**测试步骤**：
1. 发送GET请求到 `/api/v1/roles/123`
2. 验证响应状态码为200
3. 验证响应包含角色详细信息

**预期结果**：
- 状态码：200
- 响应包含角色详细信息

**实际结果**：⬜ 待测试

---

#### TC-016: 创建权限

**测试步骤**：
1. 发送POST请求到 `/api/v1/permissions`
2. 请求参数：
   ```json
   {
     "name": "用户创建",
     "code": "user:create",
     "type": "operation"
   }
   ```
3. 验证响应状态码为200
4. 验证权限创建成功

**预期结果**：
- 状态码：200
- 响应包含权限信息

**实际结果**：⬜ 待测试

---

#### TC-017: 获取权限列表

**测试步骤**：
1. 发送GET请求到 `/api/v1/permissions?page=1&page_size=10`
2. 验证响应状态码为200
3. 验证响应包含权限列表

**预期结果**：
- 状态码：200
- 响应包含：total, items, page, page_size

**实际结果**：⬜ 待测试

---

#### TC-018: 创建菜单

**测试步骤**：
1. 发送POST请求到 `/api/v1/menus`
2. 请求参数：
   ```json
   {
     "name": "系统管理",
     "path": "/system",
     "icon": "setting",
     "tenant_id": "default"
   }
   ```
3. 验证响应状态码为200
4. 验证菜单创建成功

**预期结果**：
- 状态码：200
- 响应包含菜单信息

**实际结果**：⬜ 待测试

---

#### TC-019: 获取菜单列表

**测试步骤**：
1. 发送GET请求到 `/api/v1/menus?page=1&page_size=10`
2. 验证响应状态码为200
3. 验证响应包含菜单列表

**预期结果**：
- 状态码：200
- 响应包含：total, items, page, page_size

**实际结果**：⬜ 待测试

---

#### TC-020: 获取菜单树

**测试步骤**：
1. 发送GET请求到 `/api/v1/menus/tree?tenant_id=default`
2. 验证响应状态码为200
3. 验证响应包含菜单树结构

**预期结果**：
- 状态码：200
- 响应包含菜单树（包含children字段）

**实际结果**：⬜ 待测试

---

#### TC-021: 健康检查

**测试步骤**：
1. 分别访问三个服务的健康检查接口
   - http://localhost:8001/health
   - http://localhost:8002/health
   - http://localhost:8003/health
2. 验证所有服务健康检查接口返回正常

**预期结果**：
- 所有服务返回：{"status": "healthy", "service": "服务名称"}

**实际结果**：⬜ 待测试

---

## 🧪 测试方法

### 测试工具

1. **Postman** - 接口测试工具
2. **curl** - 命令行工具
3. **Python脚本** - 自动化测试脚本

### 测试步骤

1. **环境准备**
   - 确保MySQL、Redis、Nacos、RabbitMQ已启动
   - 确保数据库已创建（执行init_db.sql）
   - 确保Python环境已配置

2. **启动服务**
   ```bash
   # 启动认证域服务
   cd backend/services/auth-service
   pip install -r requirements.txt
   python -m uvicorn app.main:app --host 0.0.0.0 --port 8001 --reload
   
   # 启动用户域服务
   cd backend/services/user-service
   pip install -r requirements.txt
   python -m uvicorn app.main:app --host 0.0.0.0 --port 8002 --reload
   
   # 启动权限域服务
   cd backend/services/permission-service
   pip install -r requirements.txt
   python -m uvicorn app.main:app --host 0.0.0.0 --port 8003 --reload
   ```

3. **执行测试**
   - 按照测试用例逐个执行
   - 记录测试结果
   - 发现问题及时修复

4. **生成报告**
   - 汇总测试结果
   - 生成测试报告
   - 记录问题和改进建议

---

## 📊 测试进度跟踪

### 总体进度

| 服务 | 总用例数 | 已完成 | 失败 | 待测试 | 完成率 |
|-----|---------|--------|------|--------|--------|
| **认证域服务** | 3 | 0 | 0 | 3 | 0% |
| **用户域服务** | 9 | 0 | 0 | 9 | 0% |
| **权限域服务** | 9 | 0 | 0 | 9 | 0% |
| **总计** | **21** | **0** | **0** | **21** | **0%** |

### 测试用例状态

| 编号 | 用例名称 | 服务 | 状态 | 执行时间 | 结果 | 备注 |
|-----|---------|------|------|---------|------|------|
| TC-001 | 用户登录 | 认证域服务 | ⬜ 待测试 | - | - | - |
| TC-002 | 刷新Token | 认证域服务 | ⬜ 待测试 | - | - | - |
| TC-003 | 用户登出 | 认证域服务 | ⬜ 待测试 | - | - | - |
| TC-004 | 创建用户 | 用户域服务 | ⬜ 待测试 | - | - | - |
| TC-005 | 获取用户列表 | 用户域服务 | ⬜ 待测试 | - | - | - |
| TC-006 | 获取用户详情 | 用户域服务 | ⬜ 待测试 | - | - | - |
| TC-007 | 更新用户 | 用户域服务 | ⬜ 待测试 | - | - | - |
| TC-008 | 删除用户 | 用户域服务 | ⬜ 待测试 | - | - | - |
| TC-009 | 创建部门 | 用户域服务 | ⬜ 待测试 | - | - | - |
| TC-010 | 获取部门列表 | 用户域服务 | ⬜ 待测试 | - | - | - |
| TC-011 | 获取部门树 | 用户域服务 | ⬜ 待测试 | - | - | - |
| TC-012 | 创建租户 | 用户域服务 | ⬜ 待测试 | - | - | - |
| TC-013 | 创建角色 | 权限域服务 | ⬜ 待测试 | - | - | - |
| TC-014 | 获取角色列表 | 权限域服务 | ⬜ 待测试 | - | - | - |
| TC-015 | 获取角色详情 | 权限域服务 | ⬜ 待测试 | - | - | - |
| TC-016 | 创建权限 | 权限域服务 | ⬜ 待测试 | - | - | - |
| TC-017 | 获取权限列表 | 权限域服务 | ⬜ 待测试 | - | - | - |
| TC-018 | 创建菜单 | 权限域服务 | ⬜ 待测试 | - | - | - |
| TC-019 | 获取菜单列表 | 权限域服务 | ⬜ 待测试 | - | - | - |
| TC-020 | 获取菜单树 | 权限域服务 | ⬜ 待测试 | - | - | - |
| TC-021 | 健康检查 | 所有服务 | ⬜ 待测试 | - | - | - |

---

## 📝 测试报告模板

### 测试结果汇总

**测试时间**：2026-01-15
**测试版本**：v1.0
**测试人员**：AI助手

| 指标 | 结果 |
|-----|------|
| **总用例数** | 21 |
| **通过数** | 0 |
| **失败数** | 0 |
| **待测试** | 21 |
| **通过率** | 0% |

### 问题汇总

| 编号 | 问题描述 | 严重程度 | 状态 | 备注 |
|-----|---------|---------|------|------|
| - | - | - | - | - |

### 改进建议

| 编号 | 建议内容 | 优先级 | 状态 |
|-----|---------|--------|------|
| - | - | - | - |

---

## ✅ 测试执行结果

### 测试执行信息

- **测试开始时间**：2026-01-15 10:26:03
- **测试结束时间**：2026-01-15 10:26:28
- **测试执行时长**：25秒
- **测试报告**：[测试报告.json](./测试报告.json)

### 测试结果汇总

| 指标 | 结果 |
|-----|------|
| **总用例数** | 23（包括3个健康检查） |
| **通过数** | 4 |
| **失败数** | 19 |
| **通过率** | 17.39% |

### 各服务测试结果

#### 健康检查 ✅

| 服务 | 端口 | 状态 | 响应时间 |
|-----|------|------|---------|
| auth-service | 8001 | ✅ 通过 | 2.08s |
| user-service | 8002 | ✅ 通过 | 2.04s |
| permission-service | 8003 | ✅ 通过 | 2.05s |

#### 认证域服务（auth-service:8001）

| 用例编号 | 接口 | 方法 | 状态 | 响应时间 | 备注 |
|---------|------|------|------|---------|------|
| TC-001 | /api/v1/auth/login | POST | ❌ 失败(500) | 0.03s | 服务端异常 |
| TC-002 | /api/v1/auth/refresh | POST | ❌ 失败(连接中断) | - | ConnectionResetError |
| TC-003 | /api/v1/auth/logout | POST | ✅ 通过 | 2.06s | - |

**通过率**：1/3 (33.33%)

#### 用户域服务（user-service:8002）

| 用例编号 | 接口 | 方法 | 状态 | 响应时间 | 备注 |
|---------|------|------|------|---------|------|
| TC-004 | /api/v1/users | POST | ❌ 失败(500) | 0.02s | 服务端异常 |
| TC-005 | /api/v1/users | GET | ❌ 失败(连接中断) | - | ConnectionResetError |
| TC-006 | /api/v1/users/{id} | GET | ❌ 失败(500) | 2.05s | 服务端异常 |
| TC-007 | /api/v1/users/{id} | PUT | ❌ 失败(连接中断) | - | ConnectionResetError |
| TC-008 | /api/v1/users/{id} | DELETE | ❌ 失败(500) | 2.03s | 服务端异常 |
| TC-009 | /api/v1/departments | POST | ❌ 失败(连接中断) | - | ConnectionResetError |
| TC-010 | /api/v1/departments | GET | ❌ 失败(500) | 2.06s | 服务端异常 |
| TC-011 | /api/v1/departments/tree | GET | ❌ 失败(连接中断) | - | ConnectionResetError |
| TC-012 | /api/v1/tenants | POST | ❌ 失败(500) | 2.08s | 服务端异常 |

**通过率**：0/9 (0%)

#### 权限域服务（permission-service:8003）

| 用例编号 | 接口 | 方法 | 状态 | 响应时间 | 备注 |
|---------|------|------|------|---------|------|
| TC-013 | /api/v1/roles | POST | ❌ 失败(500) | 2.07s | 服务端异常 |
| TC-014 | /api/v1/roles | GET | ❌ 失败(连接中断) | - | ConnectionResetError |
| TC-015 | /api/v1/roles/{id} | GET | ❌ 失败(500) | 2.05s | 服务端异常 |
| TC-016 | /api/v1/permissions | POST | ❌ 失败(连接中断) | - | ConnectionResetError |
| TC-017 | /api/v1/permissions | GET | ❌ 失败(500) | 2.09s | 服务端异常 |
| TC-018 | /api/v1/menus | POST | ❌ 失败(连接中断) | - | ConnectionResetError |
| TC-019 | /api/v1/menus | GET | ❌ 失败(500) | 2.08s | 服务端异常 |
| TC-020 | /api/v1/menus/tree | GET | ❌ 失败(连接中断) | - | ConnectionResetError |

**通过率**：0/8 (0%)

### 问题汇总

| 编号 | 问题描述 | 严重程度 | 状态 | 备注 |
|-----|---------|---------|------|------|
| 1 | 大部分业务接口返回500错误 | 🔴 高 | 未解决 | 服务端代码实现异常 |
| 2 | 部分接口出现连接中断 | 🔴 高 | 未解决 | ConnectionResetError，可能是服务崩溃 |
| 3 | 数据库连接和会话管理可能存在问题 | 🔴 高 | 未解决 | 需要排查数据库配置 |

### 改进建议

| 编号 | 建议内容 | 优先级 | 状态 |
|-----|---------|--------|------|
| 1 | 修复数据库连接配置和会话管理 | 🔴 高 | 待处理 |
| 2 | 完善错误处理和日志记录 | 🔴 高 | 待处理 |
| 3 | 添加数据初始化脚本（创建测试数据） | 🟡 中 | 待处理 |
| 4 | 实现完整的业务逻辑代码 | 🔴 高 | 待处理 |
| 5 | 添加单元测试和集成测试 | 🟡 中 | 待处理 |

### 下一步计划

1. **修复数据库连接问题**：检查数据库连接配置，确保服务能正确连接数据库
2. **完善业务逻辑实现**：修复所有返回500错误的接口
3. **添加测试数据**：创建初始化脚本，添加必要的测试数据
4. **重新执行测试**：修复问题后重新执行所有测试用例
5. **提高测试覆盖率**：确保所有接口都有对应的测试用例

---

## 🔗 相关文档

- [开发进度确认单](../开发进度确认单.md)
- [API接口设计文档](./4-API接口设计文档.md)
- [环境配置文档](./7-环境配置文档.md)

---

**最后更新时间**：2026-01-15
**测试状态**：准备开始