# 后端业务功能测试计划

## 文档信息

**文档名称**: 后端业务功能测试计划
**创建时间**: 2026-01-16
**版本**: v1.0
**状态**: 待执行

---

## 1. 测试目标

### 1.1 主要目标
- 验证所有后端业务功能是否符合需求规格说明
- 确保所有API接口功能正常、性能达标
- 发现并修复功能缺陷和安全漏洞
- 确保系统稳定性和可靠性

### 1.2 测试范围
- 所有P0核心功能
- 所有P1重要功能
- 所有P2可选功能

---

## 2. 测试环境

### 2.1 测试环境配置

| 环境 | 数据库 | Redis | RabbitMQ | 说明 |
|-----|--------|-------|----------|------|
| 开发环境 | MySQL 8.0+ | 可选 | 可选 | 本地开发测试 |
| 测试环境 | MySQL 8.0+ | Redis 7.0+ | RabbitMQ 3.12+ | 功能测试 |
| 预生产环境 | MySQL 8.0+ | Redis 7.0+ | RabbitMQ 3.12+ | 集成测试 |

### 2.2 测试数据
- 测试租户数据
- 测试用户数据
- 测试角色和权限数据
- 测试业务数据（MCP工具、字典、地区等）

---

## 3. 测试工具

| 工具名称 | 用途 | 版本 |
|---------|------|------|
| pytest | 单元测试框架 | 7.4+ |
| pytest-asyncio | 异步测试支持 | 0.21+ |
| pytest-cov | 代码覆盖率 | 4.1+ |
| httpx | HTTP客户端测试 | 0.25+ |
| Postman | API接口测试 | Latest |
| JMeter | 性能测试 | 5.6+ |
| Swagger UI | API文档和测试 | Latest |

---

## 4. 测试策略

### 4.1 测试类型

#### 4.1.1 单元测试
- 测试单个函数和方法
- 测试Repository层
- 测试Service层
- 代码覆盖率目标：80%+

#### 4.1.2 集成测试
- 测试API接口
- 测试服务间交互
- 测试数据库操作
- 测试缓存功能
- 测试消息队列

#### 4.1.3 功能测试
- 测试业务流程
- 测试用户场景
- 测试权限控制
- 测试多租户隔离

#### 4.1.4 性能测试
- 响应时间测试
- 并发测试
- 压力测试
- 稳定性测试

### 4.2 测试优先级

| 优先级 | 描述 | 测试重点 |
|-------|------|---------|
| P0 | 核心功能 | 认证授权、用户管理、权限控制 |
| P1 | 重要功能 | MCP工具管理、日志审计、待办任务 |
| P2 | 可选功能 | 字典管理、地区管理、站内信 |

---

## 5. 测试用例

### 5.1 P0核心功能测试用例

#### 5.1.1 认证授权（auth-service）

| 用例ID | 测试场景 | 测试步骤 | 预期结果 | 优先级 |
|-------|---------|---------|---------|-------|
| AUTH-001 | 用户登录 | 1. 输入正确的用户名和密码<br>2. 点击登录按钮 | 返回JWT Token，登录成功 | P0 |
| AUTH-002 | 用户登录失败 | 1. 输入错误的用户名或密码<br>2. 点击登录按钮 | 返回错误提示，登录失败 | P0 |
| AUTH-003 | Token验证 | 1. 使用有效的JWT Token访问接口 | 访问成功，返回数据 | P0 |
| AUTH-004 | Token过期 | 1. 使用过期的JWT Token访问接口 | 返回401错误，提示Token过期 | P0 |
| AUTH-005 | API Key认证 | 1. 使用有效的API Key访问接口 | 访问成功，返回数据 | P0 |
| AUTH-006 | API Key无效 | 1. 使用无效的API Key访问接口 | 返回401错误，提示API Key无效 | P0 |
| AUTH-007 | 用户登出 | 1. 调用登出接口 | Token失效，登出成功 | P0 |
| AUTH-008 | 刷新Token | 1. 使用刷新Token获取新Token | 返回新的JWT Token | P0 |

#### 5.1.2 用户管理（user-service）

| 用例ID | 测试场景 | 测试步骤 | 预期结果 | 优先级 |
|-------|---------|---------|---------|-------|
| USER-001 | 创建用户 | 1. 输入用户信息<br>2. 提交创建请求 | 用户创建成功，返回用户信息 | P0 |
| USER-002 | 查询用户列表 | 1. 调用查询接口 | 返回用户列表，包含分页信息 | P0 |
| USER-003 | 查询用户详情 | 1. 输入用户ID<br>2. 调用查询接口 | 返回用户详细信息 | P0 |
| USER-004 | 更新用户信息 | 1. 输入用户ID和更新信息<br>2. 提交更新请求 | 用户信息更新成功 | P0 |
| USER-005 | 删除用户 | 1. 输入用户ID<br>2. 调用删除接口 | 用户删除成功 | P0 |
| USER-006 | 用户密码修改 | 1. 输入旧密码和新密码<br>2. 提交修改请求 | 密码修改成功，可以使用新密码登录 | P0 |
| USER-007 | 用户状态启用/禁用 | 1. 修改用户状态<br>2. 提交修改请求 | 用户状态更新成功 | P0 |
| USER-008 | 用户与部门关联 | 1. 将用户关联到部门<br>2. 提交关联请求 | 关联成功，用户属于该部门 | P0 |
| USER-009 | 用户与角色关联 | 1. 将用户关联到角色<br>2. 提交关联请求 | 关联成功，用户拥有该角色权限 | P0 |

#### 5.1.3 部门管理（user-service）

| 用例ID | 测试场景 | 测试步骤 | 预期结果 | 优先级 |
|-------|---------|---------|---------|-------|
| DEPT-001 | 创建部门 | 1. 输入部门信息<br>2. 提交创建请求 | 部门创建成功，返回部门信息 | P0 |
| DEPT-002 | 查询部门列表 | 1. 调用查询接口 | 返回部门列表，支持树形结构 | P0 |
| DEPT-003 | 查询部门详情 | 1. 输入部门ID<br>2. 调用查询接口 | 返回部门详细信息 | P0 |
| DEPT-004 | 更新部门信息 | 1. 输入部门ID和更新信息<br>2. 提交更新请求 | 部门信息更新成功 | P0 |
| DEPT-005 | 删除部门 | 1. 输入部门ID<br>2. 调用删除接口 | 部门删除成功 | P0 |
| DEPT-006 | 部门层级管理 | 1. 创建子部门<br>2. 查询部门树 | 子部门创建成功，树形结构正确 | P0 |
| DEPT-007 | 部门与用户关联 | 1. 将用户添加到部门<br>2. 查询部门用户列表 | 关联成功，用户在部门列表中 | P0 |

#### 5.1.4 租户管理（user-service）

| 用例ID | 测试场景 | 测试步骤 | 预期结果 | 优先级 |
|-------|---------|---------|---------|-------|
| TENANT-001 | 创建租户 | 1. 输入租户信息<br>2. 提交创建请求 | 租户创建成功，返回租户信息 | P0 |
| TENANT-002 | 查询租户列表 | 1. 调用查询接口 | 返回租户列表，包含分页信息 | P0 |
| TENANT-003 | 查询租户详情 | 1. 输入租户ID<br>2. 调用查询接口 | 返回租户详细信息 | P0 |
| TENANT-004 | 更新租户信息 | 1. 输入租户ID和更新信息<br>2. 提交更新请求 | 租户信息更新成功 | P0 |
| TENANT-005 | 删除租户 | 1. 输入租户ID<br>2. 调用删除接口 | 租户删除成功，关联数据也被删除 | P0 |
| TENANT-006 | 租户数据隔离 | 1. 租户A创建数据<br>2. 租户B查询数据 | 租户B无法查询到租户A的数据 | P0 |
| TENANT-007 | 租户状态管理 | 1. 修改租户状态<br>2. 提交修改请求 | 租户状态更新成功，影响租户访问 | P0 |

#### 5.1.5 角色管理（permission-service）

| 用例ID | 测试场景 | 测试步骤 | 预期结果 | 优先级 |
|-------|---------|---------|---------|-------|
| ROLE-001 | 创建角色 | 1. 输入角色信息<br>2. 提交创建请求 | 角色创建成功，返回角色信息 | P0 |
| ROLE-002 | 查询角色列表 | 1. 调用查询接口 | 返回角色列表，包含分页信息 | P0 |
| ROLE-003 | 查询角色详情 | 1. 输入角色ID<br>2. 调用查询接口 | 返回角色详细信息 | P0 |
| ROLE-004 | 更新角色信息 | 1. 输入角色ID和更新信息<br>2. 提交更新请求 | 角色信息更新成功 | P0 |
| ROLE-005 | 删除角色 | 1. 输入角色ID<br>2. 调用删除接口 | 角色删除成功 | P0 |
| ROLE-006 | 角色与权限关联 | 1. 将权限分配给角色<br>2. 提交关联请求 | 关联成功，角色拥有该权限 | P0 |
| ROLE-007 | 角色与用户关联 | 1. 将角色分配给用户<br>2. 查询用户角色列表 | 关联成功，用户拥有该角色 | P0 |
| ROLE-008 | 角色权限查询 | 1. 查询角色的所有权限 | 返回角色拥有的所有权限列表 | P0 |

#### 5.1.6 权限管理（permission-service）

| 用例ID | 测试场景 | 测试步骤 | 预期结果 | 优先级 |
|-------|---------|---------|---------|-------|
| PERM-001 | 创建权限 | 1. 输入权限信息<br>2. 提交创建请求 | 权限创建成功，返回权限信息 | P0 |
| PERM-002 | 查询权限列表 | 1. 调用查询接口 | 返回权限列表，包含分页信息 | P0 |
| PERM-003 | 查询权限详情 | 1. 输入权限ID<br>2. 调用查询接口 | 返回权限详细信息 | P0 |
| PERM-004 | 更新权限信息 | 1. 输入权限ID和更新信息<br>2. 提交更新请求 | 权限信息更新成功 | P0 |
| PERM-005 | 删除权限 | 1. 输入权限ID<br>2. 调用删除接口 | 权限删除成功 | P0 |
| PERM-006 | 用户权限查询 | 1. 查询用户的所有权限 | 返回用户拥有的所有权限列表 | P0 |
| PERM-007 | 权限验证 | 1. 用户访问需要权限的接口 | 有权限则访问成功，无权限则拒绝 | P0 |
| PERM-008 | 权限缓存 | 1. 查询用户权限<br>2. 再次查询用户权限 | 第二次查询使用缓存，响应更快 | P0 |

#### 5.1.7 菜单管理（permission-service）

| 用例ID | 测试场景 | 测试步骤 | 预期结果 | 优先级 |
|-------|---------|---------|---------|-------|
| MENU-001 | 创建菜单 | 1. 输入菜单信息<br>2. 提交创建请求 | 菜单创建成功，返回菜单信息 | P0 |
| MENU-002 | 查询菜单列表 | 1. 调用查询接口 | 返回菜单列表，支持树形结构 | P0 |
| MENU-003 | 查询菜单详情 | 1. 输入菜单ID<br>2. 调用查询接口 | 返回菜单详细信息 | P0 |
| MENU-004 | 更新菜单信息 | 1. 输入菜单ID和更新信息<br>2. 提交更新请求 | 菜单信息更新成功 | P0 |
| MENU-005 | 删除菜单 | 1. 输入菜单ID<br>2. 调用删除接口 | 菜单删除成功 | P0 |
| MENU-006 | 菜单层级管理 | 1. 创建子菜单<br>2. 查询菜单树 | 子菜单创建成功，树形结构正确 | P0 |
| MENU-007 | 用户菜单查询 | 1. 查询用户的菜单列表 | 返回用户有权限访问的菜单列表 | P0 |
| MENU-008 | 菜单与权限关联 | 1. 将权限关联到菜单<br>2. 提交关联请求 | 关联成功，菜单需要该权限才能访问 | P0 |

### 5.2 P1重要功能测试用例

#### 5.2.1 数据范围权限（permission-service）

| 用例ID | 测试场景 | 测试步骤 | 预期结果 | 优先级 |
|-------|---------|---------|---------|-------|
| DATASCOPE-001 | 创建数据范围 | 1. 输入数据范围信息<br>2. 提交创建请求 | 数据范围创建成功 | P1 |
| DATASCOPE-002 | 查询数据范围列表 | 1. 调用查询接口 | 返回数据范围列表 | P1 |
| DATASCOPE-003 | 用户数据范围配置 | 1. 为用户配置数据范围<br>2. 提交配置请求 | 配置成功，用户拥有该数据范围 | P1 |
| DATASCOPE-004 | 全部数据权限 | 1. 用户拥有全部数据权限<br>2. 查询数据 | 返回所有数据 | P1 |
| DATASCOPE-005 | 本部门数据权限 | 1. 用户拥有本部门数据权限<br>2. 查询数据 | 只返回本部门数据 | P1 |
| DATASCOPE-006 | 本部门及以下数据权限 | 1. 用户拥有本部门及以下数据权限<br>2. 查询数据 | 返回本部门及子部门数据 | P1 |
| DATASCOPE-007 | 仅本人数据权限 | 1. 用户拥有仅本人数据权限<br>2. 查询数据 | 只返回用户自己的数据 | P1 |

#### 5.2.2 日志审计（support-service）

| 用例ID | 测试场景 | 测试步骤 | 预期结果 | 优先级 |
|-------|---------|---------|---------|-------|
| LOG-001 | 登录日志记录 | 1. 用户登录<br>2. 查询登录日志 | 登录日志记录成功 | P1 |
| LOG-002 | 操作日志记录 | 1. 用户执行操作<br>2. 查询操作日志 | 操作日志记录成功 | P1 |
| LOG-003 | 查询登录日志列表 | 1. 调用查询接口 | 返回登录日志列表 | P1 |
| LOG-004 | 查询操作日志列表 | 1. 调用查询接口 | 返回操作日志列表 | P1 |
| LOG-005 | 日志统计 | 1. 调用统计接口 | 返回日志统计信息 | P1 |
| LOG-006 | 日志筛选 | 1. 按用户筛选日志<br>2. 按时间筛选日志 | 筛选结果正确 | P1 |

#### 5.2.3 权限缓存（permission-service）

| 用例ID | 测试场景 | 测试步骤 | 预期结果 | 优先级 |
|-------|---------|---------|---------|-------|
| CACHE-001 | 缓存用户权限 | 1. 查询用户权限<br>2. 检查Redis缓存 | 权限已缓存到Redis | P1 |
| CACHE-002 | 缓存角色权限 | 1. 查询角色权限<br>2. 检查Redis缓存 | 权限已缓存到Redis | P1 |
| CACHE-003 | 缓存用户菜单 | 1. 查询用户菜单<br>2. 检查Redis缓存 | 菜单已缓存到Redis | P1 |
| CACHE-004 | 缓存过期 | 1. 等待缓存过期时间<br>2. 再次查询权限 | 缓存过期，重新查询数据库 | P1 |
| CACHE-005 | 缓存更新 | 1. 修改用户权限<br>2. 查询用户权限 | 缓存已更新，返回最新权限 | P1 |
| CACHE-006 | 缓存删除 | 1. 删除用户权限<br>2. 检查Redis缓存 | 缓存已删除 | P1 |

#### 5.2.4 待办任务管理（support-service）

| 用例ID | 测试场景 | 测试步骤 | 预期结果 | 优先级 |
|-------|---------|---------|---------|-------|
| TODO-001 | 创建待办任务 | 1. 输入待办任务信息<br>2. 提交创建请求 | 待办任务创建成功 | P1 |
| TODO-002 | 查询待办任务列表 | 1. 调用查询接口 | 返回待办任务列表 | P1 |
| TODO-003 | 查询待办任务详情 | 1. 输入待办任务ID<br>2. 调用查询接口 | 返回待办任务详细信息 | P1 |
| TODO-004 | 更新待办任务 | 1. 输入待办任务ID和更新信息<br>2. 提交更新请求 | 待办任务更新成功 | P1 |
| TODO-005 | 删除待办任务 | 1. 输入待办任务ID<br>2. 调用删除接口 | 待办任务删除成功 | P1 |
| TODO-006 | 标记任务完成 | 1. 标记待办任务为完成<br>2. 查询待办任务 | 任务状态已更新为完成 | P1 |
| TODO-007 | 任务优先级设置 | 1. 设置任务优先级<br>2. 查询待办任务 | 优先级已更新 | P1 |
| TODO-008 | 任务截止时间设置 | 1. 设置任务截止时间<br>2. 查询待办任务 | 截止时间已更新 | P1 |
| TODO-009 | 每日计划创建 | 1. 创建每日计划<br>2. 查询每日计划 | 每日计划创建成功 | P1 |
| TODO-010 | 每日计划完成率统计 | 1. 查询每日计划统计 | 返回完成率统计信息 | P1 |

#### 5.2.5 工作流管理（business-service）

| 用例ID | 测试场景 | 测试步骤 | 预期结果 | 优先级 |
|-------|---------|---------|---------|-------|
| WORKFLOW-001 | 创建工作流 | 1. 输入工作流信息<br>2. 提交创建请求 | 工作流创建成功 | P1 |
| WORKFLOW-002 | 查询工作流列表 | 1. 调用查询接口 | 返回工作流列表 | P1 |
| WORKFLOW-003 | 查询工作流详情 | 1. 输入工作流ID<br>2. 调用查询接口 | 返回工作流详细信息 | P1 |
| WORKFLOW-004 | 启动工作流 | 1. 启动工作流实例<br>2. 查询工作流状态 | 工作流启动成功，状态为运行中 | P1 |
| WORKFLOW-005 | 审批任务处理 | 1. 处理审批任务<br>2. 查询工作流状态 | 审批任务处理成功，工作流继续 | P1 |
| WORKFLOW-006 | 工作流监控 | 1. 查询工作流执行日志 | 返回工作流执行日志 | P1 |
| WORKFLOW-007 | 工作流统计 | 1. 查询工作流统计信息 | 返回工作流统计信息 | P1 |
| WORKFLOW-008 | 预置审批模板 | 1. 使用预置模板创建工作流<br>2. 查询工作流 | 工作流创建成功，包含预置节点 | P1 |

### 5.3 P2可选功能测试用例

#### 5.3.1 岗位管理（user-service）

| 用例ID | 测试场景 | 测试步骤 | 预期结果 | 优先级 |
|-------|---------|---------|---------|-------|
| POSITION-001 | 创建岗位 | 1. 输入岗位信息<br>2. 提交创建请求 | 岗位创建成功 | P2 |
| POSITION-002 | 查询岗位列表 | 1. 调用查询接口 | 返回岗位列表 | P2 |
| POSITION-003 | 查询岗位详情 | 1. 输入岗位ID<br>2. 调用查询接口 | 返回岗位详细信息 | P2 |
| POSITION-004 | 更新岗位信息 | 1. 输入岗位ID和更新信息<br>2. 提交更新请求 | 岗位信息更新成功 | P2 |
| POSITION-005 | 删除岗位 | 1. 输入岗位ID<br>2. 调用删除接口 | 岗位删除成功 | P2 |
| POSITION-006 | 岗位与用户关联 | 1. 将用户关联到岗位<br>2. 查询岗位用户列表 | 关联成功，用户在岗位列表中 | P2 |

#### 5.3.2 字典管理（system-service）

| 用例ID | 测试场景 | 测试步骤 | 预期结果 | 优先级 |
|-------|---------|---------|---------|-------|
| DICT-001 | 创建字典 | 1. 输入字典信息<br>2. 提交创建请求 | 字典创建成功 | P2 |
| DICT-002 | 查询字典列表 | 1. 调用查询接口 | 返回字典列表 | P2 |
| DICT-003 | 查询字典详情 | 1. 输入字典ID<br>2. 调用查询接口 | 返回字典详细信息 | P2 |
| DICT-004 | 更新字典信息 | 1. 输入字典ID和更新信息<br>2. 提交更新请求 | 字典信息更新成功 | P2 |
| DICT-005 | 删除字典 | 1. 输入字典ID<br>2. 调用删除接口 | 字典删除成功 | P2 |
| DICT-006 | 创建字典项 | 1. 输入字典项信息<br>2. 提交创建请求 | 字典项创建成功 | P2 |
| DICT-007 | 查询字典项列表 | 1. 输入字典ID<br>2. 调用查询接口 | 返回字典项列表 | P2 |
| DICT-008 | 根据字典类型查询 | 1. 输入字典类型<br>2. 调用查询接口 | 返回该类型的字典项列表 | P2 |

#### 5.3.3 错误码管理（system-service）

| 用例ID | 测试场景 | 测试步骤 | 预期结果 | 优先级 |
|-------|---------|---------|---------|-------|
| ERRORCODE-001 | 创建错误码 | 1. 输入错误码信息<br>2. 提交创建请求 | 错误码创建成功 | P2 |
| ERRORCODE-002 | 查询错误码列表 | 1. 调用查询接口 | 返回错误码列表 | P2 |
| ERRORCODE-003 | 查询错误码详情 | 1. 输入错误码ID<br>2. 调用查询接口 | 返回错误码详细信息 | P2 |
| ERRORCODE-004 | 根据错误码查询 | 1. 输入错误码<br>2. 调用查询接口 | 返回错误码详细信息 | P2 |
| ERRORCODE-005 | 更新错误码信息 | 1. 输入错误码ID和更新信息<br>2. 提交更新请求 | 错误码信息更新成功 | P2 |
| ERRORCODE-006 | 删除错误码 | 1. 输入错误码ID<br>2. 调用删除接口 | 错误码删除成功 | P2 |
| ERRORCODE-007 | 错误码统计 | 1. 调用统计接口 | 返回错误码统计信息 | P2 |

#### 5.3.4 敏感词管理（system-service）

| 用例ID | 测试场景 | 测试步骤 | 预期结果 | 优先级 |
|-------|---------|---------|---------|-------|
| SENSITIVE-001 | 创建敏感词 | 1. 输入敏感词信息<br>2. 提交创建请求 | 敏感词创建成功 | P2 |
| SENSITIVE-002 | 查询敏感词列表 | 1. 调用查询接口 | 返回敏感词列表 | P2 |
| SENSITIVE-003 | 查询敏感词详情 | 1. 输入敏感词ID<br>2. 调用查询接口 | 返回敏感词详细信息 | P2 |
| SENSITIVE-004 | 更新敏感词信息 | 1. 输入敏感词ID和更新信息<br>2. 提交更新请求 | 敏感词信息更新成功 | P2 |
| SENSITIVE-005 | 删除敏感词 | 1. 输入敏感词ID<br>2. 调用删除接口 | 敏感词删除成功 | P2 |
| SENSITIVE-006 | 文本检查 | 1. 输入包含敏感词的文本<br>2. 调用检查接口 | 返回检查结果，包含敏感词列表 | P2 |
| SENSITIVE-007 | 文本过滤 | 1. 输入包含敏感词的文本<br>2. 调用过滤接口 | 返回过滤后的文本，敏感词被替换 | P2 |
| SENSITIVE-008 | 敏感词统计 | 1. 调用统计接口 | 返回敏感词统计信息 | P2 |

#### 5.3.5 地区管理（system-service）

| 用例ID | 测试场景 | 测试步骤 | 预期结果 | 优先级 |
|-------|---------|---------|---------|-------|
| REGION-001 | 创建地区 | 1. 输入地区信息<br>2. 提交创建请求 | 地区创建成功 | P2 |
| REGION-002 | 查询地区列表 | 1. 调用查询接口 | 返回地区列表 | P2 |
| REGION-003 | 查询地区详情 | 1. 输入地区ID<br>2. 调用查询接口 | 返回地区详细信息 | P2 |
| REGION-004 | 根据地区编码查询 | 1. 输入地区编码<br>2. 调用查询接口 | 返回地区详细信息 | P2 |
| REGION-005 | 更新地区信息 | 1. 输入地区ID和更新信息<br>2. 提交更新请求 | 地区信息更新成功 | P2 |
| REGION-006 | 删除地区 | 1. 输入地区ID<br>2. 调用删除接口 | 地区删除成功 | P2 |
| REGION-007 | 查询子地区 | 1. 输入父地区ID<br>2. 调用查询接口 | 返回子地区列表 | P2 |
| REGION-008 | 查询地区树 | 1. 调用查询接口 | 返回地区树形结构 | P2 |
| REGION-009 | 地区统计 | 1. 调用统计接口 | 返回地区统计信息 | P2 |

#### 5.3.6 站内信（support-service）

| 用例ID | 测试场景 | 测试步骤 | 预期结果 | 优先级 |
|-------|---------|---------|---------|-------|
| MESSAGE-001 | 创建站内信 | 1. 输入站内信信息<br>2. 提交创建请求 | 站内信创建成功 | P2 |
| MESSAGE-002 | 查询站内信列表 | 1. 调用查询接口 | 返回站内信列表 | P2 |
| MESSAGE-003 | 查询站内信详情 | 1. 输入站内信ID<br>2. 调用查询接口 | 返回站内信详细信息 | P2 |
| MESSAGE-004 | 根据接收者查询 | 1. 输入接收者ID<br>2. 调用查询接口 | 返回接收者的站内信列表 | P2 |
| MESSAGE-005 | 查询未读站内信 | 1. 输入接收者ID<br>2. 调用查询接口 | 返回未读站内信列表 | P2 |
| MESSAGE-006 | 更新站内信信息 | 1. 输入站内信ID和更新信息<br>2. 提交更新请求 | 站内信信息更新成功 | P2 |
| MESSAGE-007 | 删除站内信 | 1. 输入站内信ID<br>2. 调用删除接口 | 站内信删除成功 | P2 |
| MESSAGE-008 | 标记站内信为已读 | 1. 标记站内信为已读<br>2. 查询站内信 | 站内信状态已更新为已读 | P2 |
| MESSAGE-009 | 查询未读数量 | 1. 输入接收者ID<br>2. 调用统计接口 | 返回未读站内信数量 | P2 |
| MESSAGE-010 | 站内信统计 | 1. 调用统计接口 | 返回站内信统计信息 | P2 |

#### 5.3.7 通知公告（support-service）

| 用例ID | 测试场景 | 测试步骤 | 预期结果 | 优先级 |
|-------|---------|---------|---------|-------|
| ANNOUNCEMENT-001 | 创建通知公告 | 1. 输入通知公告信息<br>2. 提交创建请求 | 通知公告创建成功 | P2 |
| ANNOUNCEMENT-002 | 查询通知公告列表 | 1. 调用查询接口 | 返回通知公告列表 | P2 |
| ANNOUNCEMENT-003 | 查询通知公告详情 | 1. 输入通知公告ID<br>2. 调用查询接口 | 返回通知公告详细信息 | P2 |
| ANNOUNCEMENT-004 | 查询已发布通知公告 | 1. 调用查询接口 | 返回已发布通知公告列表 | P2 |
| ANNOUNCEMENT-005 | 更新通知公告信息 | 1. 输入通知公告ID和更新信息<br>2. 提交更新请求 | 通知公告信息更新成功 | P2 |
| ANNOUNCEMENT-006 | 删除通知公告 | 1. 输入通知公告ID<br>2. 调用删除接口 | 通知公告删除成功 | P2 |
| ANNOUNCEMENT-007 | 发布通知公告 | 1. 发布通知公告<br>2. 查询通知公告 | 通知公告状态已更新为已发布 | P2 |
| ANNOUNCEMENT-008 | 归档通知公告 | 1. 归档通知公告<br>2. 查询通知公告 | 通知公告状态已更新为已归档 | P2 |
| ANNOUNCEMENT-009 | 标记通知公告为已读 | 1. 标记通知公告为已读<br>2. 查询阅读记录 | 阅读记录创建成功 | P2 |
| ANNOUNCEMENT-010 | 查询阅读数量 | 1. 输入通知公告ID<br>2. 调用统计接口 | 返回阅读数量 | P2 |
| ANNOUNCEMENT-011 | 查询用户未读数量 | 1. 输入用户ID<br>2. 调用统计接口 | 返回用户未读通知公告数量 | P2 |

---

## 6. 测试执行计划

### 6.1 测试阶段

| 阶段 | 任务 | 预计时间 | 负责人 |
|-----|------|---------|--------|
| 阶段一 | 单元测试 | 3天 | 开发团队 |
| 阶段二 | 集成测试 | 5天 | 测试团队 |
| 阶段三 | 功能测试 | 7天 | 测试团队 |
| 阶段四 | 性能测试 | 3天 | 测试团队 |
| 阶段五 | 缺陷修复 | 5天 | 开发团队 |
| 阶段六 | 回归测试 | 3天 | 测试团队 |

### 6.2 测试时间安排

| 日期 | 测试内容 | 备注 |
|-----|---------|------|
| 第1-3天 | 单元测试 | 测试Repository和Service层 |
| 第4-8天 | 集成测试 | 测试API接口和服务间交互 |
| 第9-15天 | 功能测试 | 测试所有业务功能 |
| 第16-18天 | 性能测试 | 测试响应时间和并发能力 |
| 第19-23天 | 缺陷修复 | 修复发现的缺陷 |
| 第24-26天 | 回归测试 | 验证缺陷修复 |

---

## 7. 测试报告

### 7.1 测试报告模板

#### 7.1.1 测试概况

| 项目 | 内容 |
|-----|------|
| 测试名称 | 后端业务功能测试 |
| 测试时间 | YYYY-MM-DD ~ YYYY-MM-DD |
| 测试人员 | XXX, XXX |
| 测试环境 | 开发环境 / 测试环境 |
| 测试版本 | v1.0 |

#### 7.1.2 测试结果统计

| 指标 | 数量 | 占比 |
|-----|------|------|
| 总用例数 | XXX | 100% |
| 通过数 | XXX | XX% |
| 失败数 | XXX | XX% |
| 阻塞数 | XXX | XX% |

#### 7.1.3 缺陷统计

| 严重级别 | 数量 | 占比 |
|---------|------|------|
| 致命 | XXX | XX% |
| 严重 | XXX | XX% |
| 一般 | XXX | XX% |
| 轻微 | XXX | XX% |

#### 7.1.4 测试结论

- 测试通过率：XX%
- 是否可以发布：是 / 否
- 建议：XXX

### 7.2 缺陷报告模板

| 缺陷ID | 模块 | 严重级别 | 缺陷描述 | 复现步骤 | 状态 |
|-------|------|---------|---------|---------|------|
| BUG-001 | auth-service | 严重 | XXX | XXX | 待修复 |
| BUG-002 | user-service | 一般 | XXX | XXX | 已修复 |

---

## 8. 测试验收标准

### 8.1 功能验收标准
- 所有P0核心功能测试用例通过率：100%
- 所有P1重要功能测试用例通过率：95%+
- 所有P2可选功能测试用例通过率：90%+

### 8.2 性能验收标准
- API响应时间：< 500ms（95%的请求）
- 并发支持：100+ 并发用户
- 系统可用性：99.9%

### 8.3 安全验收标准
- 无高危安全漏洞
- 无中危安全漏洞
- 权限控制正常
- 数据隔离正常

---

## 9. 风险管理

### 9.1 测试风险

| 风险 | 影响 | 应对措施 |
|-----|------|---------|
| 测试环境不稳定 | 测试延迟 | 提前准备备用环境 |
| 测试数据不完整 | 测试覆盖不足 | 准备完整的测试数据 |
| 测试时间不足 | 测试质量下降 | 优先测试核心功能 |
| 缺陷修复延迟 | 发布延期 | 提前预留修复时间 |

---

## 10. 附录

### 10.1 测试环境搭建指南

#### 10.1.1 开发环境搭建

```bash
# 1. 克隆项目
git clone https://github.com/klpk961224/mcp-platform.git

# 2. 安装依赖
cd backend
pip install -r requirements.txt

# 3. 配置数据库
cp .env.development .env
# 修改.env文件中的数据库配置

# 4. 初始化数据库
python scripts/execute_init_db.py

# 5. 启动服务
python -m app.main
```

#### 10.1.2 测试环境搭建

```bash
# 1. 启动MySQL
docker run -d --name mysql -p 3306:3306 -e MYSQL_ROOT_PASSWORD=root mysql:8.0

# 2. 启动Redis（可选）
docker run -d --name redis -p 6379:6379 redis:7.0

# 3. 启动RabbitMQ（可选）
docker run -d --name rabbitmq -p 5672:5672 -p 15672:15672 rabbitmq:3.12

# 4. 配置环境变量
cp .env.test .env
# 修改.env文件中的配置

# 5. 运行测试
pytest tests/ -v --cov=app --cov-report=html
```

### 10.2 测试数据准备

#### 10.2.1 测试租户数据

```sql
INSERT INTO tenants (id, name, code, status) VALUES
('tenant1', '测试租户1', 'test_tenant_1', 'active'),
('tenant2', '测试租户2', 'test_tenant_2', 'active');
```

#### 10.2.2 测试用户数据

```sql
INSERT INTO users (id, username, password, email, tenant_id, status) VALUES
('user1', 'testuser1', '$2b$12$xxx', 'testuser1@example.com', 'tenant1', 'active'),
('user2', 'testuser2', '$2b$12$xxx', 'testuser2@example.com', 'tenant2', 'active');
```

### 10.3 常见问题

**Q: 如何运行单元测试？**
A: 使用命令 `pytest tests/ -v` 运行所有单元测试。

**Q: 如何查看测试覆盖率？**
A: 使用命令 `pytest tests/ --cov=app --cov-report=html` 生成覆盖率报告。

**Q: 如何调试测试失败？**
A: 使用命令 `pytest tests/ -v -s` 查看详细输出。

---

**最后更新**: 2026-01-16