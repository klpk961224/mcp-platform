def test_login_success(self, auth_service, mock_user):
    """测试登录成功"""
    # 模拟用户查询
    auth_service.user_repo.get_by_username = Mock(return_value=mock_user)
    # 模拟Token创建
    auth_service.token_repo.create_token = Mock()
    # 模拟密码验证
    with patch('app.services.auth_service.verify_password', return_value=True):
        # 模拟Token生成
        with patch('app.services.auth_service.create_access_token', return_value='access_token'):
            with patch('app.services.auth_service.create_refresh_token', return_value='refresh_token'):
                # 模拟用户更新
                auth_service.user_repo.update = Mock()
                # 执行登录
                result = auth_service.login(username="testuser", password="password")
                
                # 验证结果
                assert result["access_token"] == "access_token"
                assert result["refresh_token"] == "refresh_token"
                assert result["user_info"]["username"] == "testuser"
