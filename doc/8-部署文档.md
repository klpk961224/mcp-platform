# 閮ㄧ讲鏂囨。

## 馃搵 鏂囨。淇℃伅

- **椤圭洰鍚嶇О**锛氫紒涓氱骇AI缁煎悎绠＄悊骞冲彴
- **鏂囨。鐗堟湰**锛歷1.1
- **鍒涘缓鏃ユ湡**锛?026-01-13
- **鏈€鍚庢洿鏂?*锛?026-01-18
- **鏂囨。绫诲瀷**锛氶儴缃叉枃妗?
- **褰撳墠鐘舵€?*锛氬悗绔笟鍔″姛鑳藉紑鍙戝畬鎴愶紙100%锛夛紝鍚庣鍗曞厓娴嬭瘯瀹屾垚锛?00%锛夛紝鍚庣闆嗘垚娴嬭瘯瀹屾垚锛?00%锛夛紝Docker閮ㄧ讲閰嶇疆瀹屽杽

---

## 1. Docker閮ㄧ讲鏂规

### 1.1 鍚庣Dockerfile

```dockerfile
# 鍚庣Dockerfile
FROM python:3.13-slim

WORKDIR /app

# 瀹夎绯荤粺渚濊禆
RUN apt-get update && apt-get install -y \
    gcc \
    g++ \
    && rm -rf /var/lib/apt/lists/*

# 澶嶅埗渚濊禆鏂囦欢
COPY requirements.txt .

# 瀹夎Python渚濊禆
RUN pip install --no-cache-dir -r requirements.txt

# 澶嶅埗搴旂敤浠ｇ爜
COPY . .

# 鏆撮湶绔彛
EXPOSE 8000

# 鍚姩鍛戒护
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]
```

### 1.2 鍓嶇Dockerfile

```dockerfile
# 鍓嶇Dockerfile锛堝闃舵鏋勫缓锛?
FROM node:18-alpine AS builder

WORKDIR /app

# 澶嶅埗渚濊禆鏂囦欢
COPY package*.json ./

# 瀹夎渚濊禆
RUN npm ci

# 澶嶅埗婧愪唬鐮?
COPY . .

# 鏋勫缓
RUN npm run build

# 鐢熶骇闀滃儚
FROM nginx:alpine

# 澶嶅埗鏋勫缓浜х墿
COPY --from=builder /app/dist /usr/share/nginx/html

# 澶嶅埗nginx閰嶇疆
COPY nginx.conf /etc/nginx/conf.d/default.conf

# 鏆撮湶绔彛
EXPOSE 80

# 鍚姩nginx
CMD ["nginx", "-g", "daemon off;"]
```

### 1.3 docker-compose.yml

```yaml
version: '3.8'

services:
  # MySQL鏁版嵁搴?
  mysql:
    image: mysql:8.0
    container_name: mcp-mysql
    environment:
      MYSQL_ROOT_PASSWORD: 12345678
      MYSQL_DATABASE: mcp_platform
    ports:
      - "3306:3306"
    volumes:
      - mysql-data:/var/lib/mysql
    networks:
      - mcp-network

  # Redis缂撳瓨
  redis:
    image: redis:7.0
    container_name: mcp-redis
    ports:
      - "6379:6379"
    volumes:
      - redis-data:/data
    networks:
      - mcp-network

  # Nacos閰嶇疆涓績
  nacos:
    image: nacos/nacos-server:v2.2.0
    container_name: mcp-nacos
    environment:
      MODE: standalone
    ports:
      - "8848:8848"
      - "9848:9848"
    networks:
      - mcp-network

  # RabbitMQ娑堟伅闃熷垪
  rabbitmq:
    image: rabbitmq:3.12-management
    container_name: mcp-rabbitmq
    environment:
      RABBITMQ_DEFAULT_USER: admin
      RABBITMQ_DEFAULT_PASS: admin123
    ports:
      - "5672:5672"
      - "15672:15672"
    networks:
      - mcp-network

  # 鍓嶇鏈嶅姟
  frontend:
    build: ./frontend
    container_name: mcp-frontend
    ports:
      - "3000:80"
    depends_on:
      - apisix
    networks:
      - mcp-network

  # APISIX缃戝叧
  apisix:
    image: apache/apisix:3.5.0-debian
    container_name: mcp-apisix
    ports:
      - "9080:9080"
      - "9443:9443"
      - "9180:9180"
    volumes:
      - ./apisix/config.yaml:/usr/local/apisix/conf/config.yaml:ro
    depends_on:
      - etcd
    networks:
      - mcp-network

  # etcd锛圓PISIX渚濊禆锛?
  etcd:
    image: bitnami/etcd:3.5
    container_name: mcp-etcd
    environment:
      - ALLOW_NONE_AUTHENTICATION=yes
      - ETCD_ADVERTISE_CLIENT_URLS=http://etcd:2379
    ports:
      - "2379:2379"
    networks:
      - mcp-network

  # 璁よ瘉鍩熸湇鍔?
  auth-service:
    build: ./services/auth-service
    container_name: mcp-auth-service
    ports:
      - "8001:28001"
    environment:
      - DB_HOST=mysql
      - DB_PORT=3306
      - DB_NAME=mcp_platform
      - DB_USER=root
      - DB_PASSWORD=12345678
      - REDIS_HOST=redis
      - REDIS_PORT=6379
      - NACOS_HOST=nacos
      - NACOS_PORT=8848
      - USE_NACOS=False
    depends_on:
      - mysql
      - redis
      - nacos
    networks:
      - mcp-network

  # 鐢ㄦ埛鍩熸湇鍔?
  user-service:
    build: ./services/user-service
    container_name: mcp-user-service
    ports:
      - "8002:28002"
    environment:
      - DB_HOST=mysql
      - DB_PORT=3306
      - DB_NAME=mcp_platform
      - DB_USER=root
      - DB_PASSWORD=12345678
      - REDIS_HOST=redis
      - REDIS_PORT=6379
      - NACOS_HOST=nacos
      - NACOS_PORT=8848
      - USE_NACOS=False
    depends_on:
      - mysql
      - redis
      - nacos
    networks:
      - mcp-network

  # 鏉冮檺鍩熸湇鍔?
  permission-service:
    build: ./services/permission-service
    container_name: mcp-permission-service
    ports:
      - "8003:28003"
    environment:
      - DB_HOST=mysql
      - DB_PORT=3306
      - DB_NAME=mcp_platform
      - DB_USER=root
      - DB_PASSWORD=12345678
      - REDIS_HOST=redis
      - REDIS_PORT=6379
      - NACOS_HOST=nacos
      - NACOS_PORT=8848
      - USE_NACOS=False
    depends_on:
      - mysql
      - redis
      - nacos
    networks:
      - mcp-network

  # 绯荤粺鍩熸湇鍔?
  system-service:
    build: ./services/system-service
    container_name: mcp-system-service
    ports:
      - "8004:28004"
    environment:
      - DB_HOST=mysql
      - DB_PORT=3306
      - DB_NAME=mcp_platform
      - DB_USER=root
      - DB_PASSWORD=12345678
      - REDIS_HOST=redis
      - REDIS_PORT=6379
      - NACOS_HOST=nacos
      - NACOS_PORT=8848
      - RABBITMQ_HOST=rabbitmq
      - RABBITMQ_PORT=5672
      - RABBITMQ_USERNAME=admin
      - RABBITMQ_PASSWORD=admin123
      - USE_NACOS=False
      - USE_RABBITMQ=False
    depends_on:
      - mysql
      - redis
      - nacos
      - rabbitmq
    networks:
      - mcp-network

  # 鏀拺鍩熸湇鍔?
  support-service:
    build: ./services/support-service
    container_name: mcp-support-service
    ports:
      - "8005:28005"
    environment:
      - DB_HOST=mysql
      - DB_PORT=3306
      - DB_NAME=mcp_platform
      - DB_USER=root
      - DB_PASSWORD=12345678
      - REDIS_HOST=redis
      - REDIS_PORT=6379
      - NACOS_HOST=nacos
      - NACOS_PORT=8848
      - RABBITMQ_HOST=rabbitmq
      - RABBITMQ_PORT=5672
      - RABBITMQ_USERNAME=admin
      - RABBITMQ_PASSWORD=admin123
      - USE_NACOS=False
      - USE_RABBITMQ=False
    depends_on:
      - mysql
      - redis
      - nacos
      - rabbitmq
    networks:
      - mcp-network

  # 涓氬姟鍩熸湇鍔★紙宸ヤ綔娴佺鐞嗭級
  business-service:
    build: ./services/business-service
    container_name: mcp-business-service
    ports:
      - "8006:28006"
    environment:
      - DB_HOST=mysql
      - DB_PORT=3306
      - DB_NAME=mcp_platform
      - DB_USER=root
      - DB_PASSWORD=12345678
      - REDIS_HOST=redis
      - REDIS_PORT=6379
      - NACOS_HOST=nacos
      - NACOS_PORT=8848
      - USE_NACOS=False
    depends_on:
      - mysql
      - redis
      - nacos
    networks:
      - mcp-network

volumes:
  mysql-data:
  redis-data:

networks:
  mcp-network:
    driver: bridge
```
      - NACOS_PORT=8848
      - RABBITMQ_HOST=rabbitmq
      - RABBITMQ_PORT=5672
    depends_on:
      - mysql
      - redis
      - nacos
      - rabbitmq
    networks:
      - mcp-network

  # 鍓嶇鏈嶅姟
  frontend:
    build: ./frontend
    container_name: mcp-frontend
    ports:
      - "80:80"
    depends_on:
      - backend
    networks:
      - mcp-network

volumes:
  mysql-data:
  redis-data:

networks:
  mcp-network:
    driver: bridge
```

### 1.4 閮ㄧ讲娴佺▼鍥?

```mermaid
graph LR
    A[缂栧啓Dockerfile] --> B[缂栧啓docker-compose.yml]
    B --> C[鏋勫缓闀滃儚]
    C --> D[鍚姩瀹瑰櫒]
    D --> E[楠岃瘉閮ㄧ讲]
    E --> F[閰嶇疆璐熻浇鍧囪　]
```

---

## 2. Kubernetes閮ㄧ讲鏂规

### 2.1 鍚庣閮ㄧ讲閰嶇疆

```yaml
# backend-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: backend
  namespace: mcp-platform
spec:
  replicas: 3
  selector:
    matchLabels:
      app: backend
  template:
    metadata:
      labels:
        app: backend
    spec:
      containers:
      - name: backend
        image: mcp-platform/backend:latest
        ports:
        - containerPort: 8000
        env:
        - name: DB_HOST
          valueFrom:
            configMapKeyRef:
              name: backend-config
              key: DB_HOST
        - name: DB_PASSWORD
          valueFrom:
            secretKeyRef:
              name: backend-secret
              key: DB_PASSWORD
        resources:
          requests:
            memory: "256Mi"
            cpu: "250m"
          limits:
            memory: "512Mi"
            cpu: "500m"
        livenessProbe:
          httpGet:
            path: /health
            port: 8000
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /ready
            port: 8000
          initialDelaySeconds: 10
          periodSeconds: 5
---
apiVersion: v1
kind: Service
metadata:
  name: backend-service
  namespace: mcp-platform
spec:
  selector:
    app: backend
  ports:
  - port: 80
    targetPort: 8000
  type: ClusterIP
```

### 2.2 鍓嶇閮ㄧ讲閰嶇疆

```yaml
# frontend-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: frontend
  namespace: mcp-platform
spec:
  replicas: 2
  selector:
    matchLabels:
      app: frontend
  template:
    metadata:
      labels:
        app: frontend
    spec:
      containers:
      - name: frontend
        image: mcp-platform/frontend:latest
        ports:
        - containerPort: 80
        resources:
          requests:
            memory: "128Mi"
            cpu: "100m"
          limits:
            memory: "256Mi"
            cpu: "200m"
---
apiVersion: v1
kind: Service
metadata:
  name: frontend-service
  namespace: mcp-platform
spec:
  selector:
    app: frontend
  ports:
  - port: 80
    targetPort: 80
  type: ClusterIP
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: mcp-ingress
  namespace: mcp-platform
spec:
  rules:
  - host: mcp.example.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: frontend-service
            port:
              number: 80
```

---

## 3. 閮ㄧ讲娴佺▼璇存槑

### 3.1 Docker閮ㄧ讲娴佺▼

```bash
# 1. 鏋勫缓闀滃儚
docker-compose build

# 2. 鍚姩鏈嶅姟
docker-compose up -d

# 3. 鏌ョ湅鏃ュ織
docker-compose logs -f

# 4. 鍋滄鏈嶅姟
docker-compose down
```

### 3.2 Kubernetes閮ㄧ讲娴佺▼

```bash
# 1. 鍒涘缓鍛藉悕绌洪棿
kubectl create namespace mcp-platform

# 2. 鍒涘缓ConfigMap
kubectl apply -f k8s/configmap.yaml

# 3. 鍒涘缓Secret
kubectl apply -f k8s/secret.yaml

# 4. 閮ㄧ讲搴旂敤
kubectl apply -f k8s/

# 5. 鏌ョ湅鐘舵€?
kubectl get pods -n mcp-platform

# 6. 鏌ョ湅鏈嶅姟
kubectl get svc -n mcp-platform

# 7. 鏌ョ湅鏃ュ織
kubectl logs -f deployment/backend -n mcp-platform
```

---

## 4. 閮ㄧ讲鑴氭湰绀轰緥

### 4.1 涓€閿儴缃茶剼鏈?

```bash
#!/bin/bash

# deploy.sh

echo "寮€濮嬮儴缃蹭紒涓氱骇AI缁煎悎绠＄悊骞冲彴..."

# 妫€鏌ocker鏄惁瀹夎
if ! command -v docker &> /dev/null; then
    echo "Docker鏈畨瑁咃紝璇峰厛瀹夎Docker"
    exit 1
fi

# 妫€鏌ocker-compose鏄惁瀹夎
if ! command -v docker-compose &> /dev/null; then
    echo "docker-compose鏈畨瑁咃紝璇峰厛瀹夎docker-compose"
    exit 1
fi

# 鏋勫缓闀滃儚
echo "鏋勫缓Docker闀滃儚..."
docker-compose build

# 鍚姩鏈嶅姟
echo "鍚姩鏈嶅姟..."
docker-compose up -d

# 绛夊緟鏈嶅姟鍚姩
echo "绛夊緟鏈嶅姟鍚姩..."
sleep 10

# 妫€鏌ユ湇鍔＄姸鎬?
echo "妫€鏌ユ湇鍔＄姸鎬?.."
docker-compose ps

echo "閮ㄧ讲瀹屾垚锛?
echo "璁块棶鍦板潃锛?
echo "  鍓嶇锛歨ttp://localhost"
echo "  鍚庣锛歨ttp://localhost:8000"
```

---

## 5. 鍋ュ悍妫€鏌ラ厤缃?

### 5.1 鍚庣鍋ュ悍妫€鏌?

```python
# main.py
from fastapi import FastAPI

app = FastAPI()

@app.get("/health")
async def health_check():
    """鍋ュ悍妫€鏌ユ帴鍙?""
    return {
        "status": "healthy",
        "service": "mcp-platform-backend",
        "version": "1.0.0"
    }

@app.get("/ready")
async def readiness_check():
    """灏辩华妫€鏌ユ帴鍙?""
    # 妫€鏌ユ暟鎹簱杩炴帴
    # 妫€鏌edis杩炴帴
    # 妫€鏌abbitMQ杩炴帴
    return {
        "status": "ready",
        "checks": {
            "database": "ok",
            "redis": "ok",
            "rabbitmq": "ok"
        }
    }
```

---

## 6. 鍥炴粴绛栫暐

### 6.1 Docker鍥炴粴

```bash
# 鏌ョ湅闀滃儚鐗堟湰
docker images | grep mcp-platform

# 鍥炴粴鍒颁笂涓€涓増鏈?
docker-compose down
docker-compose up -d --scale backend=2 --scale frontend=2

# 浣跨敤鎸囧畾鐗堟湰
docker tag mcp-platform/backend:v1.0.1 mcp-platform/backend:latest
docker-compose up -d
```

### 6.2 Kubernetes鍥炴粴

```bash
# 鏌ョ湅閮ㄧ讲鍘嗗彶
kubectl rollout history deployment/backend -n mcp-platform

# 鍥炴粴鍒颁笂涓€涓増鏈?
kubectl rollout undo deployment/backend -n mcp-platform

# 鍥炴粴鍒版寚瀹氱増鏈?
kubectl rollout undo deployment/backend --to-revision=2 -n mcp-platform
```

---

## 馃敆 鐩稿叧鏂囨。

- [鐜閰嶇疆鏂囨。](./7-鐜閰嶇疆鏂囨。.md)
- [杩愮淮鏂囨。](./10-杩愮淮鏂囨。.md)
- [澶栭儴杞欢鏈嶅姟闇€姹傛竻鍗昡(./0-澶栭儴杞欢鏈嶅姟闇€姹傛竻鍗?md)

---

## 馃挕 娉ㄦ剰浜嬮」

1. **闀滃儚绠＄悊**锛氫娇鐢ㄩ暅鍍忕増鏈爣绛撅紝閬垮厤浣跨敤latest鏍囩
2. **璧勬簮闄愬埗**锛氬悎鐞嗚缃祫婧愰檺鍒讹紝閬垮厤璧勬簮鑰楀敖
3. **鍋ュ悍妫€鏌?*锛氶厤缃仴搴锋鏌ワ紝鑷姩閲嶅惎寮傚父瀹瑰櫒
4. **鏃ュ織鏀堕泦**锛氶厤缃棩蹇楁敹闆嗭紝渚夸簬闂鎺掓煡
5. **澶囦唤绛栫暐**锛氬畾鏈熷浠芥暟鎹拰閰嶇疆

---

**鏂囨。鐗堟湰鍘嗗彶**锛?

| 鐗堟湰 | 鏃ユ湡 | 浣滆€?| 鍙樻洿璇存槑 |
|-----|------|------|---------|
| v1.0 | 2026-01-13 | AI鍔╂墜 | 鍒濆鐗堟湰 |

---
