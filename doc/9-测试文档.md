# æµ‹è¯•æ–‡æ¡£

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

- **é¡¹ç›®åç§°**ï¼šä¼ä¸šçº§AIç»¼åˆç®¡ç†å¹³å°
- **æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.1
- **åˆ›å»ºæ—¥æœŸ**ï¼š2026-01-13
- **æœ€åæ›´æ–°**ï¼š2026-01-18
- **æ–‡æ¡£ç±»å‹**ï¼šæµ‹è¯•æ–‡æ¡£
- **å½“å‰çŠ¶æ€**ï¼šåç«¯ä¸šåŠ¡åŠŸèƒ½å¼€å‘å®Œæˆï¼ˆ100%ï¼‰ï¼Œåç«¯å•å…ƒæµ‹è¯•å®Œæˆï¼ˆ100%ï¼Œ154/154é€šè¿‡ï¼‰ï¼Œåç«¯é›†æˆæµ‹è¯•å®Œæˆï¼ˆ100%ï¼Œ23/23é€šè¿‡ï¼‰

---

## 1. æµ‹è¯•ç­–ç•¥

### 1.1 æµ‹è¯•é‡‘å­—å¡”

```mermaid
graph TB
    A[å•å…ƒæµ‹è¯•<br/>70%] --> B[é›†æˆæµ‹è¯•<br/>20%]
    B --> C[ç«¯åˆ°ç«¯æµ‹è¯•<br/>10%]
```

### 1.2 æµ‹è¯•ç±»å‹

| æµ‹è¯•ç±»å‹ | è¦†ç›–ç‡ | è´Ÿè´£äºº | å·¥å…· |
|---------|--------|--------|------|
| **å•å…ƒæµ‹è¯•** | >80% | å¼€å‘äººå‘˜ | pytest |
| **é›†æˆæµ‹è¯•** | >60% | æµ‹è¯•äººå‘˜ | pytest |
| **æ€§èƒ½æµ‹è¯•** | - | æµ‹è¯•äººå‘˜ | JMeter |
| **å®‰å…¨æµ‹è¯•** | - | å®‰å…¨ä¸“å®¶ | OWASP ZAP |

---

## 2. å•å…ƒæµ‹è¯•è§„èŒƒ

### 2.1 Pythonå•å…ƒæµ‹è¯•

```python
# tests/test_user_service.py
import pytest
from app.services.user_service import UserService
from app.models.user import User

def test_create_user():
    """æµ‹è¯•åˆ›å»ºç”¨æˆ·"""
    user_service = UserService()
    user_data = {
        "username": "test_user",
        "email": "test@example.com",
        "password": "password123"
    }
    user = user_service.create_user(user_data)
    assert user.id is not None
    assert user.username == "test_user"

def test_get_user_by_id():
    """æµ‹è¯•æ ¹æ®IDè·å–ç”¨æˆ·"""
    user_service = UserService()
    user = user_service.get_user_by_id("1")
    assert user is not None
    assert user.id == "1"

def test_update_user():
    """æµ‹è¯•æ›´æ–°ç”¨æˆ·"""
    user_service = UserService()
    update_data = {"email": "newemail@example.com"}
    user = user_service.update_user("1", update_data)
    assert user.email == "newemail@example.com"

def test_delete_user():
    """æµ‹è¯•åˆ é™¤ç”¨æˆ·"""
    user_service = UserService()
    result = user_service.delete_user("1")
    assert result is True
```

### 2.2 TypeScriptå•å…ƒæµ‹è¯•

```typescript
// tests/userStore.spec.ts
import { setActivePinia, createPinia } from 'pinia'
import { describe, it, expect, beforeEach } from 'vitest'
import { useUserStore } from '@/stores/user'

describe('User Store', () => {
  beforeEach(() => {
    setActivePinia(createPinia())
  })

  it('should set user info', () => {
    const userStore = useUserStore()
    userStore.setUserInfo({
      id: '1',
      username: 'admin',
      email: 'admin@example.com'
    })
    expect(userStore.userInfo).toBeDefined()
    expect(userStore.userInfo?.username).toBe('admin')
  })

  it('should clear user info', () => {
    const userStore = useUserStore()
    userStore.clearUserInfo()
    expect(userStore.userInfo).toBeNull()
  })
})
```

---

## 3. é›†æˆæµ‹è¯•è§„èŒƒ

### 3.1 APIé›†æˆæµ‹è¯•

```python
# tests/test_api/test_user_api.py
import pytest
from httpx import AsyncClient
from main import app

@pytest.mark.asyncio
async def test_create_user_api():
    """æµ‹è¯•åˆ›å»ºç”¨æˆ·API"""
    async with AsyncClient(app=app, base_url="http://test") as ac:
        response = await ac.post(
            "/api/v1/users",
            json={
                "username": "test_user",
                "email": "test@example.com",
                "password": "password123"
            }
        )
        assert response.status_code == 201
        data = response.json()
        assert data["success"] is True
        assert data["data"]["username"] == "test_user"

@pytest.mark.asyncio
async def test_get_user_list_api():
    """æµ‹è¯•è·å–ç”¨æˆ·åˆ—è¡¨API"""
    async with AsyncClient(app=app, base_url="http://test") as ac:
        response = await ac.get("/api/v1/users?page=1&size=10")
        assert response.status_code == 200
        data = response.json()
        assert data["success"] is True
        assert "items" in data["data"]
        assert "total" in data["data"]
```

---

## 4. æ€§èƒ½æµ‹è¯•è§„èŒƒ

### 4.1 æ€§èƒ½æµ‹è¯•æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | æµ‹è¯•å·¥å…· |
|-----|--------|---------|
| **å“åº”æ—¶é—´** | < 200ms (95%) | JMeter |
| **ååé‡** | > 1000 TPS | JMeter |
| **å¹¶å‘ç”¨æˆ·** | > 1000 | JMeter |
| **å¯ç”¨æ€§** | > 99.9% | JMeter |

### 4.2 JMeteræµ‹è¯•è®¡åˆ’

```xml
<?xml version="1.0" encoding="UTF-8"?>
<jmeterTestPlan version="1.2" properties="5.0">
  <hashTree>
    <TestPlan guiclass="TestPlan" testclass="TestPlan" testname="æ€§èƒ½æµ‹è¯•è®¡åˆ’">
      <elementProp name="TestPlan.comments" elementType="string"/>
      <stringProp name="TestPlan.user_define_classpath"/>
      <boolProp name="TestPlan.functional_mode" value="false"/>
      <boolProp name="TestPlan.serialize_threadgroups" value="false"/>
      <elementProp name="TestPlan.user_defined_variables" elementType="Arguments">
        <collectionProp name="Arguments.arguments">
          <elementProp name="BASE_URL" elementType="Argument">
            <stringProp name="Argument.value">http://localhost:8000</stringProp>
          </elementProp>
        </collectionProp>
      </elementProp>
      <ThreadGroup guiclass="ThreadGroup" testclass="ThreadGroup" testname="ç”¨æˆ·æŸ¥è¯¢æ¥å£">
        <stringProp name="ThreadGroup.num_threads">100</stringProp>
        <stringProp name="ThreadGroup.ramp_time">10</stringProp>
        <stringProp name="ThreadGroup.duration">60</stringProp>
        <boolProp name="ThreadGroup.scheduler">true</boolProp>
        <elementProp name="ThreadGroup.main_controller" elementType="ThreadGroup"/>
        <LoopController guiclass="LoopController" testclass="LoopController" testname="å¾ªç¯æ§åˆ¶å™¨"/>
        <HTTPSamplerProxy guiclass="HTTPSamplerProxy" testclass="HTTPSamplerProxy" testname="HTTPè¯·æ±‚">
          <stringProp name="HTTPSampler.domain">localhost</stringProp>
          <stringProp name="HTTPSampler.port">8000</stringProp>
          <stringProp name="HTTPSampler.path">/api/v1/users</stringProp>
          <stringProp name="HTTPSampler.method">GET</stringProp>
        </HTTPSamplerProxy>
      </ThreadGroup>
    </TestPlan>
  </hashTree>
</jmeterTestPlan>
```

---

## 5. æµ‹è¯•æµç¨‹å›¾

```mermaid
graph TD
    A[ç¼–å†™æµ‹è¯•ç”¨ä¾‹] --> B[æ‰§è¡Œå•å…ƒæµ‹è¯•]
    B --> C[æ‰§è¡Œé›†æˆæµ‹è¯•]
    C --> D[æ‰§è¡Œæ€§èƒ½æµ‹è¯•]
    D --> E[ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š]
    E --> F[ä¿®å¤é—®é¢˜]
    F --> A
```

---

## 6. è‡ªåŠ¨åŒ–æµ‹è¯•æµç¨‹

### 6.1 è‡ªåŠ¨åŒ–æµ‹è¯•æ¶æ„

```mermaid
graph TB
    A[ä»£ç æäº¤] --> B[è§¦å‘CI/CD]
    B --> C[å•å…ƒæµ‹è¯•]
    C --> D[é›†æˆæµ‹è¯•]
    D --> E[ç«¯åˆ°ç«¯æµ‹è¯•]
    E --> F[ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š]
    F --> G[æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š]
    G --> H[éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ]
    H --> I{æµ‹è¯•é€šè¿‡?}
    I -->|æ˜¯| J[éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ]
    I -->|å¦| K[é€šçŸ¥å¼€å‘äººå‘˜]
    K --> L[ä¿®å¤é—®é¢˜]
    L --> A
```

### 6.2 CI/CDé›†æˆ

#### 6.2.1 GitHub Actionsé…ç½®

**å·¥ä½œæµæ–‡ä»¶ï¼ˆ.github/workflows/test.ymlï¼‰**ï¼š
```yaml
name: è‡ªåŠ¨åŒ–æµ‹è¯•

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]
  schedule:
    # æ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œå®šæ—¶æµ‹è¯•
    - cron: '0 2 * * *'

jobs:
  test:
    runs-on: ubuntu-latest
    
    strategy:
      matrix:
        python-version: [3.11, 3.12, 3.13]
        node-version: [18, 20]
    
    services:
      mysql:
        image: mysql:8.0
        env:
          MYSQL_ROOT_PASSWORD: 12345678
          MYSQL_DATABASE: mcp_platform_test
        ports:
          - 3306:3306
        options: >-
          --health-cmd="mysqladmin ping"
          --health-interval=10s
          --health-timeout=5s
          --health-retries=3
      
      redis:
        image: redis:7.0
        ports:
          - 6379:6379
        options: >-
          --health-cmd="redis-cli ping"
          --health-interval=10s
          --health-timeout=5s
          --health-retries=3
    
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v3
    
    - name: è®¾ç½®Pythonç¯å¢ƒ
      uses: actions/setup-python@v4
      with:
        python-version: ${{ matrix.python-version }}
    
    - name: è®¾ç½®Node.jsç¯å¢ƒ
      uses: actions/setup-node@v3
      with:
        node-version: ${{ matrix.node-version }}
    
    - name: å®‰è£…Pythonä¾èµ–
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pytest pytest-cov pytest-asyncio pytest-mock
    
    - name: å®‰è£…Node.jsä¾èµ–
      run: |
        npm install
        npm install -g vitest @vitest/coverage-v8
    
    - name: è¿è¡ŒPythonå•å…ƒæµ‹è¯•
      run: |
        pytest tests/unit/ --cov=app --cov-report=xml --cov-report=html --cov-report=term
    
    - name: è¿è¡ŒPythoné›†æˆæµ‹è¯•
      run: |
        pytest tests/integration/ --cov=app --cov-append --cov-report=xml --cov-report=html
    
    - name: è¿è¡Œå‰ç«¯å•å…ƒæµ‹è¯•
      run: |
        npm run test:unit
    
    - name: è¿è¡Œå‰ç«¯é›†æˆæµ‹è¯•
      run: |
        npm run test:integration
    
    - name: ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
      run: |
        coverage report
        coverage html
    
    - name: ä¸Šä¼ æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
      uses: codecov/codecov-action@v3
      with:
        files: ./coverage.xml,./coverage/lcov.info
        flags: unittests
        name: codecov-umbrella
    
    - name: ä¸Šä¼ æµ‹è¯•æŠ¥å‘Š
      uses: actions/upload-artifact@v3
      if: always()
      with:
        name: test-reports
        path: |
          htmlcov/
          coverage/
          test-results/
    
    - name: å‘é€æµ‹è¯•ç»“æœé€šçŸ¥
      if: failure()
      uses: 8398a7/action-slack@v3
      with:
        status: ${{ job.status }}
        text: 'æµ‹è¯•å¤±è´¥ï¼Œè¯·æ£€æŸ¥æµ‹è¯•æŠ¥å‘Š'
        webhook_url: ${{ secrets.SLACK_WEBHOOK }}
```

#### 6.2.2 æµ‹è¯•æŠ¥å‘Šç”Ÿæˆ

**Pytesté…ç½®ï¼ˆpytest.iniï¼‰**ï¼š
```ini
[pytest]
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*
addopts = 
    --verbose
    --strict-markers
    --tb=short
    --cov=app
    --cov-report=html
    --cov-report=xml
    --cov-report=term-missing
    --cov-fail-under=80

markers =
    unit: å•å…ƒæµ‹è¯•
    integration: é›†æˆæµ‹è¯•
    e2e: ç«¯åˆ°ç«¯æµ‹è¯•
    slow: æ…¢é€Ÿæµ‹è¯•
    api: APIæµ‹è¯•
    db: æ•°æ®åº“æµ‹è¯•
```

**Vitesté…ç½®ï¼ˆvitest.config.tsï¼‰**ï¼š
```typescript
import { defineConfig } from 'vitest/config'

export default defineConfig({
  test: {
    globals: true,
    environment: 'jsdom',
    coverage: {
      provider: 'v8',
      reporter: ['text', 'json', 'html', 'lcov'],
      include: ['src/**/*.{ts,tsx,vue}'],
      exclude: [
        'node_modules/',
        'src/main.ts',
        'src/**/*.d.ts',
        'src/**/*.spec.ts',
        'src/**/*.test.ts',
      ],
      statements: 80,
      branches: 80,
      functions: 80,
      lines: 80,
    },
  },
})
```

### 6.3 è‡ªåŠ¨åŒ–æµ‹è¯•æµç¨‹

#### 6.3.1 ä»£ç æäº¤è§¦å‘

**è§¦å‘æ¡ä»¶**ï¼š
- æ¨é€åˆ°mainæˆ–developåˆ†æ”¯
- åˆ›å»ºæˆ–æ›´æ–°Pull Request
- æ¨é€æ ‡ç­¾

**æ‰§è¡Œæµç¨‹**ï¼š
```mermaid
sequenceDiagram
    participant Dev as å¼€å‘äººå‘˜
    participant Git as Gitä»“åº“
    participant CI as CI/CDç³»ç»Ÿ
    participant Test as æµ‹è¯•ç¯å¢ƒ
    participant Notify as é€šçŸ¥ç³»ç»Ÿ
    
    Dev->>Git: æäº¤ä»£ç 
    Git->>CI: è§¦å‘CI/CD
    CI->>Test: è¿è¡Œå•å…ƒæµ‹è¯•
    Test-->>CI: æµ‹è¯•ç»“æœ
    CI->>Test: è¿è¡Œé›†æˆæµ‹è¯•
    Test-->>CI: æµ‹è¯•ç»“æœ
    CI->>Test: è¿è¡Œç«¯åˆ°ç«¯æµ‹è¯•
    Test-->>CI: æµ‹è¯•ç»“æœ
    CI->>CI: ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
    CI->>Notify: å‘é€æµ‹è¯•ç»“æœ
    Notify-->>Dev: æµ‹è¯•ç»“æœé€šçŸ¥
```

**æµ‹è¯•è„šæœ¬ï¼ˆrun_tests.shï¼‰**ï¼š
```bash
#!/bin/bash

# è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬

echo "å¼€å§‹æ‰§è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•..."

# 1. å•å…ƒæµ‹è¯•
echo "æ‰§è¡Œå•å…ƒæµ‹è¯•..."
pytest tests/unit/ -v --cov=app --cov-report=html --cov-report=xml
if [ $? -ne 0 ]; then
    echo "å•å…ƒæµ‹è¯•å¤±è´¥"
    exit 1
fi

# 2. é›†æˆæµ‹è¯•
echo "æ‰§è¡Œé›†æˆæµ‹è¯•..."
pytest tests/integration/ -v --cov=app --cov-append --cov-report=html --cov-report=xml
if [ $? -ne 0 ]; then
    echo "é›†æˆæµ‹è¯•å¤±è´¥"
    exit 1
fi

# 3. ç«¯åˆ°ç«¯æµ‹è¯•
echo "æ‰§è¡Œç«¯åˆ°ç«¯æµ‹è¯•..."
pytest tests/e2e/ -v --cov=app --cov-append --cov-report=html --cov-report=xml
if [ $? -ne 0 ]; then
    echo "ç«¯åˆ°ç«¯æµ‹è¯•å¤±è´¥"
    exit 1
fi

# 4. æµ‹è¯•è¦†ç›–ç‡
echo "ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š..."
coverage report --fail-under=80
if [ $? -ne 0 ]; then
    echo "æµ‹è¯•è¦†ç›–ç‡ä¸è¶³80%"
    exit 1
fi

echo "æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼"
exit 0
```

#### 6.3.2 å®šæ—¶è§¦å‘

**å®šæ—¶ä»»åŠ¡é…ç½®**ï¼š
```yaml
# .github/workflows/scheduled-test.yml
name: å®šæ—¶æµ‹è¯•

on:
  schedule:
    # æ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œ
    - cron: '0 2 * * *'
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  scheduled-test:
    runs-on: ubuntu-latest
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v3
    
    - name: è®¾ç½®Pythonç¯å¢ƒ
      uses: actions/setup-python@v4
      with:
        python-version: '3.13'
    
    - name: å®‰è£…ä¾èµ–
      run: |
        pip install -r requirements.txt
    
    - name: è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
      run: |
        pytest tests/ -v --cov=app --cov-report=html --cov-report=xml
    
    - name: ä¸Šä¼ æµ‹è¯•æŠ¥å‘Š
      uses: actions/upload-artifact@v3
      with:
        name: scheduled-test-reports
        path: htmlcov/
```

#### 6.3.3 æ‰‹åŠ¨è§¦å‘

**æ‰‹åŠ¨è§¦å‘é…ç½®**ï¼š
```yaml
# .github/workflows/manual-test.yml
name: æ‰‹åŠ¨æµ‹è¯•

on:
  workflow_dispatch:
    inputs:
      test_type:
        description: 'æµ‹è¯•ç±»å‹'
        required: true
        type: choice
        options:
          - unit
          - integration
          - e2e
          - all
      environment:
        description: 'æµ‹è¯•ç¯å¢ƒ'
        required: true
        type: choice
        options:
          - dev
          - staging
          - prod

jobs:
  manual-test:
    runs-on: ubuntu-latest
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v3
    
    - name: è®¾ç½®Pythonç¯å¢ƒ
      uses: actions/setup-python@v4
      with:
        python-version: '3.13'
    
    - name: å®‰è£…ä¾èµ–
      run: |
        pip install -r requirements.txt
    
    - name: è¿è¡Œæµ‹è¯•
      run: |
        if [ "${{ github.event.inputs.test_type }}" = "unit" ]; then
          pytest tests/unit/ -v
        elif [ "${{ github.event.inputs.test_type }}" = "integration" ]; then
          pytest tests/integration/ -v
        elif [ "${{ github.event.inputs.test_type }}" = "e2e" ]; then
          pytest tests/e2e/ -v
        else
          pytest tests/ -v
        fi
```

### 6.4 å•å…ƒæµ‹è¯•æ‰§è¡Œç»“æœ

#### 6.4.1 åç«¯å•å…ƒæµ‹è¯•å®Œæˆæƒ…å†µ

**æµ‹è¯•æ‰§è¡Œæ—¶é—´**ï¼š2026-01-16  
**æµ‹è¯•æ¡†æ¶**ï¼špytest 8.3.4  
**Pythonç‰ˆæœ¬**ï¼š3.13.5  
**æµ‹è¯•çŠ¶æ€**ï¼šâœ… å…¨éƒ¨é€šè¿‡ï¼ˆ100%ï¼‰

**æµ‹è¯•ç»“æœæ±‡æ€»**ï¼š

| æœåŠ¡åç§° | æµ‹è¯•ç”¨ä¾‹æ•° | é€šè¿‡æ•° | å¤±è´¥æ•° | é€šè¿‡ç‡ |
|---------|-----------|--------|--------|--------|
| auth-serviceï¼ˆè®¤è¯åŸŸæœåŠ¡ï¼‰ | 16 | 16 | 0 | 100% |
| user-serviceï¼ˆç”¨æˆ·åŸŸæœåŠ¡ï¼‰ | 12 | 12 | 0 | 100% |
| permission-serviceï¼ˆæƒé™åŸŸæœåŠ¡ï¼‰ | 13 | 13 | 0 | 100% |
| system-serviceï¼ˆç³»ç»ŸåŸŸæœåŠ¡ï¼‰ | 52 | 52 | 0 | 100% |
| support-serviceï¼ˆæ”¯æ’‘åŸŸæœåŠ¡ï¼‰ | 49 | 49 | 0 | 100% |
| business-serviceï¼ˆä¸šåŠ¡åŸŸæœåŠ¡ï¼‰ | 12 | 12 | 0 | 100% |
| **æ€»è®¡** | **154** | **154** | **0** | **100%** |

**å„æœåŠ¡æµ‹è¯•è¯¦æƒ…**ï¼š

**auth-serviceï¼ˆè®¤è¯åŸŸæœåŠ¡ï¼‰**ï¼š
- test_auth_service.py: 8ä¸ªæµ‹è¯•ç”¨ä¾‹
  - æµ‹è¯•AuthServiceåˆå§‹åŒ–ã€ç™»å½•æˆåŠŸ/å¤±è´¥ã€ç™»å‡ºã€Tokenåˆ·æ–°ç­‰
- test_token_service.py: 8ä¸ªæµ‹è¯•ç”¨ä¾‹
  - æµ‹è¯•TokenServiceåˆå§‹åŒ–ã€åˆ›å»ºTokenã€åŠé”€Tokenã€æ¸…ç†è¿‡æœŸTokenç­‰

**user-serviceï¼ˆç”¨æˆ·åŸŸæœåŠ¡ï¼‰**ï¼š
- test_user_service.py: 12ä¸ªæµ‹è¯•ç”¨ä¾‹
  - æµ‹è¯•UserServiceåˆå§‹åŒ–ã€åˆ›å»ºç”¨æˆ·ã€è·å–ç”¨æˆ·ã€æ›´æ–°ç”¨æˆ·ã€åˆ é™¤ç”¨æˆ·ã€æœç´¢ç”¨æˆ·ã€æ¿€æ´»/åœç”¨ç”¨æˆ·ã€ç”¨æˆ·ç»Ÿè®¡ç­‰

**permission-serviceï¼ˆæƒé™åŸŸæœåŠ¡ï¼‰**ï¼š
- test_role_service.py: 13ä¸ªæµ‹è¯•ç”¨ä¾‹
  - æµ‹è¯•RoleServiceåˆå§‹åŒ–ã€åˆ›å»ºè§’è‰²ã€è·å–è§’è‰²ã€æ›´æ–°è§’è‰²ã€åˆ é™¤è§’è‰²ã€æœç´¢è§’è‰²ã€åˆ†é…æƒé™ã€åˆ†é…èœå•ã€è§’è‰²ç»Ÿè®¡ç­‰

**system-serviceï¼ˆç³»ç»ŸåŸŸæœåŠ¡ï¼‰**ï¼š
- test_dict_service.py: 20ä¸ªæµ‹è¯•ç”¨ä¾‹
  - æµ‹è¯•DictServiceåˆå§‹åŒ–ã€åˆ›å»ºå­—å…¸ã€è·å–å­—å…¸ã€æ›´æ–°å­—å…¸ã€åˆ é™¤å­—å…¸ã€åˆ›å»ºå­—å…¸é¡¹ã€è·å–å­—å…¸é¡¹ã€æ›´æ–°å­—å…¸é¡¹ã€åˆ é™¤å­—å…¸é¡¹ç­‰
- test_error_code_service.py: 13ä¸ªæµ‹è¯•ç”¨ä¾‹
  - æµ‹è¯•ErrorCodeServiceåˆå§‹åŒ–ã€åˆ›å»ºé”™è¯¯ç ã€è·å–é”™è¯¯ç ã€æ›´æ–°é”™è¯¯ç ã€åˆ é™¤é”™è¯¯ç ã€æœç´¢é”™è¯¯ç ç­‰
- test_region_service.py: 19ä¸ªæµ‹è¯•ç”¨ä¾‹
  - æµ‹è¯•RegionServiceåˆå§‹åŒ–ã€åˆ›å»ºåœ°åŒºã€è·å–åœ°åŒºã€æ›´æ–°åœ°åŒºã€åˆ é™¤åœ°åŒºã€æœç´¢åœ°åŒºã€è·å–åœ°åŒºæ ‘ç­‰

**support-serviceï¼ˆæ”¯æ’‘åŸŸæœåŠ¡ï¼‰**ï¼š
- test_message_service.py: 15ä¸ªæµ‹è¯•ç”¨ä¾‹
  - æµ‹è¯•MessageServiceåˆå§‹åŒ–ã€è·å–ç«™å†…ä¿¡ã€åˆ›å»ºç«™å†…ä¿¡ã€æ›´æ–°ç«™å†…ä¿¡ã€åˆ é™¤ç«™å†…ä¿¡ã€æ ‡è®°å·²è¯»ã€è·å–æœªè¯»æ•°é‡ã€å‘é€ç«™å†…ä¿¡ç­‰
- test_announcement_service.py: 14ä¸ªæµ‹è¯•ç”¨ä¾‹
  - æµ‹è¯•AnnouncementServiceåˆå§‹åŒ–ã€è·å–å…¬å‘Šã€åˆ›å»ºå…¬å‘Šã€æ›´æ–°å…¬å‘Šã€åˆ é™¤å…¬å‘Šã€å‘å¸ƒå…¬å‘Šã€å½’æ¡£å…¬å‘Šã€æ ‡è®°å·²è¯»ã€è·å–å·²è¯»æ•°é‡ç­‰
- test_todo_service.py: 20ä¸ªæµ‹è¯•ç”¨ä¾‹
  - æµ‹è¯•TodoServiceåˆå§‹åŒ–ã€åˆ›å»ºå¾…åŠä»»åŠ¡ã€è·å–å¾…åŠä»»åŠ¡ã€æ›´æ–°å¾…åŠä»»åŠ¡ã€åˆ é™¤å¾…åŠä»»åŠ¡ã€å®Œæˆå¾…åŠä»»åŠ¡ã€è·å–é€¾æœŸå¾…åŠä»»åŠ¡ã€åˆ›å»ºæ¯æ—¥è®¡åˆ’ã€è·å–æ¯æ—¥è®¡åˆ’ã€æ›´æ–°æ¯æ—¥è®¡åˆ’ã€å‘é€åˆ°æœŸæé†’ã€è·å–å¾…åŠä»»åŠ¡ç»Ÿè®¡ç­‰

**business-serviceï¼ˆä¸šåŠ¡åŸŸæœåŠ¡ï¼‰**ï¼š
- test_workflow_service.py: 12ä¸ªæµ‹è¯•ç”¨ä¾‹
  - æµ‹è¯•WorkflowServiceåˆå§‹åŒ–ã€å¯åŠ¨å·¥ä½œæµã€è·å–å·¥ä½œæµã€è·å–ç”¨æˆ·å·¥ä½œæµã€å®¡æ‰¹ä»»åŠ¡ã€é©³å›ä»»åŠ¡ã€è·å–å·¥ä½œæµç»Ÿè®¡ã€ç»ˆæ­¢å·¥ä½œæµã€è·å–å·¥ä½œæµå†å²ç­‰

**æµ‹è¯•è¦†ç›–åŠŸèƒ½**ï¼š
- âœ… P0æ ¸å¿ƒåŠŸèƒ½ï¼šè®¤è¯æˆæƒã€ç”¨æˆ·ç®¡ç†ã€RBACæƒé™ã€MCPå·¥å…·ã€å¤šç§Ÿæˆ·ã€å¤šæ•°æ®æº
- âœ… P1é‡è¦åŠŸèƒ½ï¼šéƒ¨é—¨ç®¡ç†ã€è§’è‰²ç®¡ç†ã€èœå•ç®¡ç†ã€æ•°æ®èŒƒå›´æƒé™ã€æ—¥å¿—å®¡è®¡ã€æƒé™ç¼“å­˜ã€å¾…åŠä»»åŠ¡ã€å·¥ä½œæµ
- âœ… P2å¯é€‰åŠŸèƒ½ï¼šå²—ä½ç®¡ç†ã€å­—å…¸ç®¡ç†ã€é”™è¯¯ç ç®¡ç†ã€æ•æ„Ÿè¯ç®¡ç†ã€åœ°åŒºç®¡ç†ã€ç«™å†…ä¿¡ã€é€šçŸ¥å…¬å‘Š

**ä¿®å¤çš„é—®é¢˜**ï¼š
- âœ… SQLAlchemy 2.0å…¼å®¹æ€§é—®é¢˜ï¼ˆDeclarativeBaseã€Mappedã€mapped_columnï¼‰
- âœ… ç±»å‹æ³¨è§£å†²çªé—®é¢˜ï¼ˆDict vs DictModelï¼‰
- âœ… å¯¼å…¥è·¯å¾„é—®é¢˜ï¼ˆç¼ºå¤±ç±»å‹å¯¼å…¥ã€__init__.pyæ–‡ä»¶ï¼‰
- âœ… æµ‹è¯•é…ç½®é—®é¢˜ï¼ˆpytest.iniã€pythonpathï¼‰
- âœ… æ¨¡å‹å…³ç³»é—®é¢˜ï¼ˆå…³è”è¡¨ForeignKeyå¼•ç”¨ï¼‰
- âœ… æ¨¡å‹å‘½åå†²çªï¼ˆNotification vs SystemNotificationï¼‰
- âœ… æ¨¡å‹é‡å¤å®šä¹‰ï¼ˆåˆ é™¤support-serviceé‡å¤æ¨¡å‹ï¼‰
- âœ… æµ‹è¯•ä»£ç é—®é¢˜ï¼ˆMockå¯¹è±¡ã€å­—æ®µå¼•ç”¨ã€æ–¹æ³•è°ƒç”¨ï¼‰

**æµ‹è¯•æŠ¥å‘Šä½ç½®**ï¼š
- æµ‹è¯•æŠ¥å‘Šæ–‡ä»¶ï¼š`backend/tests/å•å…ƒæµ‹è¯•æŠ¥å‘Š.md`
- æµ‹è¯•ä»£ç ä½ç½®ï¼š`backend/services/*/tests/unit/`

**æµ‹è¯•æ‰§è¡Œå‘½ä»¤**ï¼š
```bash
# è¿è¡Œæ‰€æœ‰åç«¯æœåŠ¡å•å…ƒæµ‹è¯•
cd backend
python -m pytest services/*/tests/unit/ -v

# è¿è¡Œå•ä¸ªæœåŠ¡å•å…ƒæµ‹è¯•
cd backend/services/auth-service
python -m pytest tests/unit/ -v

# ç”ŸæˆHTMLæµ‹è¯•æŠ¥å‘Š
pytest tests/unit/ --html=test-report.html --self-contained-html

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pytest tests/unit/ --cov=app --cov-report=html
```

#### 6.4.2 æµ‹è¯•æŠ¥å‘Š

**HTMLæµ‹è¯•æŠ¥å‘Šï¼ˆpytest-htmlï¼‰**ï¼š
```python
# conftest.py
import pytest
from pytest_html import extras

@pytest.fixture(scope="session", autouse=True)
def setup_html_report(request):
    """è®¾ç½®HTMLæµ‹è¯•æŠ¥å‘Š"""
    request.config._metadata['Project Name'] = 'ä¼ä¸šçº§AIç»¼åˆç®¡ç†å¹³å°'
    request.config._metadata['Tester'] = 'AIåŠ©æ‰‹'
    request.config._metadata['Test Environment'] = 'Staging'
```

**é…ç½®pytest-html**ï¼š
```ini
[pytest]
addopts = 
    --html=test-report.html
    --self-contained-html
```

#### 6.4.2 æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š

**è¦†ç›–ç‡æŠ¥å‘Šç¤ºä¾‹**ï¼š
```python
# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
coverage report --omit='*/tests/*,*/venv/*'

# è¯¦ç»†è¦†ç›–ç‡æŠ¥å‘Š
coverage report -m --omit='*/tests/*,*/venv/*'

# HTMLè¦†ç›–ç‡æŠ¥å‘Š
coverage html --omit='*/tests/*,*/venv/*'
```

**è¦†ç›–ç‡æŠ¥å‘Šå†…å®¹**ï¼š
```
Name                              Stmts   Miss  Cover   Missing
-----------------------------------------------------------------------
app/__init__.py                       0      0   100%
app/main.py                          45      5    89%   23-27
app/models/user.py                   32      3    91%   45-47
app/services/user_service.py         78     12    85%   123-130, 145-150
app/api/user_api.py                  56      8    86%   67-70, 89-92
-----------------------------------------------------------------------
TOTAL                              211     28    87%
```

#### 6.4.3 æµ‹è¯•è¶‹åŠ¿åˆ†æ

**æµ‹è¯•è¶‹åŠ¿æŠ¥å‘Šï¼ˆAllureï¼‰**ï¼š
```python
# conftest.py
import allure

@pytest.hookimpl(tryfirst=True, hookwrapper=True)
def pytest_runtest_makereport(item, call):
    """ç”ŸæˆAllureæµ‹è¯•æŠ¥å‘Š"""
    outcome = yield
    report = outcome.get_result()
    
    if report.when == 'call':
        # æ·»åŠ æµ‹è¯•æ­¥éª¤
        with allure.step('æ‰§è¡Œæµ‹è¯•'):
            allure.attach(
                str(report.outcome),
                name='æµ‹è¯•ç»“æœ',
                attachment_type=allure.attachment_type.TEXT
            )
```

**é…ç½®Allure**ï¼š
```yaml
# .github/workflows/test.yml
- name: ç”ŸæˆAllureæŠ¥å‘Š
  run: |
    pytest tests/ --alluredir=allure-results
  
- name: ä¸Šä¼ AllureæŠ¥å‘Š
  uses: actions/upload-artifact@v3
  with:
    name: allure-report
    path: allure-results/

- name: å‘å¸ƒAllureæŠ¥å‘Š
  uses: simple-elf/allure-report-action@master
  with:
    github_token: ${{ secrets.GITHUB_TOKEN }}
    allure_history: allure-history
    allure_results: allure-results
```

### 6.5 è‡ªåŠ¨åŒ–æµ‹è¯•æœ€ä½³å®è·µ

**æµ‹è¯•ç¼–å†™æœ€ä½³å®è·µ**ï¼š
- âœ… æµ‹è¯•ç”¨ä¾‹ç‹¬ç«‹ï¼Œä¸ä¾èµ–æ‰§è¡Œé¡ºåº
- âœ… æµ‹è¯•æ•°æ®ç‹¬ç«‹ï¼Œä½¿ç”¨æµ‹è¯•æ•°æ®åº“
- âœ… æµ‹è¯•æ¸…ç†ï¼Œæµ‹è¯•å®Œæˆåæ¸…ç†æ•°æ®
- âœ… æµ‹è¯•å‘½åæ¸…æ™°ï¼Œæè¿°æµ‹è¯•ç›®çš„
- âœ… æµ‹è¯•è¦†ç›–å…¨é¢ï¼Œè¦†ç›–æ­£å¸¸å’Œå¼‚å¸¸æƒ…å†µ

**CI/CDæœ€ä½³å®è·µ**ï¼š
- âœ… å¿«é€Ÿåé¦ˆï¼Œæµ‹è¯•å¤±è´¥ç«‹å³é€šçŸ¥
- âœ… å¹¶è¡Œæ‰§è¡Œï¼Œæé«˜æµ‹è¯•æ•ˆç‡
- âœ… ç¼“å­˜ä¾èµ–ï¼Œå‡å°‘æ„å»ºæ—¶é—´
- âœ… æµ‹è¯•æŠ¥å‘Šï¼Œè¯¦ç»†è®°å½•æµ‹è¯•ç»“æœ
- âœ… æµ‹è¯•è¦†ç›–ç‡ï¼Œç¡®ä¿ä»£ç è´¨é‡

**æµ‹è¯•ç»´æŠ¤æœ€ä½³å®è·µ**ï¼š
- âœ… å®šæœŸæ›´æ–°æµ‹è¯•ç”¨ä¾‹
- âœ… åˆ é™¤è¿‡æ—¶çš„æµ‹è¯•ç”¨ä¾‹
- âœ… ä¼˜åŒ–æ…¢é€Ÿæµ‹è¯•
- âœ… ç›‘æ§æµ‹è¯•è¶‹åŠ¿
- âœ… æŒç»­æ”¹è¿›æµ‹è¯•æµç¨‹

---

## 8. æµ‹è¯•è¦†ç›–ç‡è¦æ±‚

| æ¨¡å— | è¦†ç›–ç‡è¦æ±‚ |
|-----|-----------|
| **ç”¨æˆ·æ¨¡å—** | >85% |
| **æƒé™æ¨¡å—** | >85% |
| **MCPå·¥å…·æ¨¡å—** | >85% |
| **å¤šæ•°æ®æºæ¨¡å—** | >80% |
| **æ•´ä½“** | >80% |

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [å¼€å‘è§„èŒƒæ–‡æ¡£](./6-å¼€å‘è§„èŒƒæ–‡æ¡£.md)
- [éƒ¨ç½²æ–‡æ¡£](./8-éƒ¨ç½²æ–‡æ¡£.md)
- [APIæ¥å£è®¾è®¡æ–‡æ¡£](./4-APIæ¥å£è®¾è®¡æ–‡æ¡£.md)

---

## ğŸ’¡ æ³¨æ„äº‹é¡¹

1. **æµ‹è¯•ç‹¬ç«‹**ï¼šæµ‹è¯•ç¯å¢ƒä¸å¼€å‘ç¯å¢ƒéš”ç¦»
2. **æµ‹è¯•æ•°æ®**ï¼šä½¿ç”¨æµ‹è¯•æ•°æ®ï¼Œé¿å…å½±å“ç”Ÿäº§æ•°æ®
3. **æµ‹è¯•æ¸…ç†**ï¼šæµ‹è¯•å®Œæˆåæ¸…ç†æµ‹è¯•æ•°æ®
4. **æµ‹è¯•æ–‡æ¡£**ï¼šåŠæ—¶æ›´æ–°æµ‹è¯•æ–‡æ¡£
5. **è‡ªåŠ¨åŒ–æµ‹è¯•**ï¼šé›†æˆåˆ°CI/CDæµç¨‹

---

**æ–‡æ¡£ç‰ˆæœ¬å†å²**ï¼š

| ç‰ˆæœ¬ | æ—¥æœŸ | ä½œè€… | å˜æ›´è¯´æ˜ |
|-----|------|------|---------|
| v1.0 | 2026-01-13 | AIåŠ©æ‰‹ | åˆå§‹ç‰ˆæœ¬ |
| v1.1 | 2026-01-16 | æ·»åŠ åç«¯ä¸šåŠ¡åŠŸèƒ½æµ‹è¯•è®¡åˆ’å®Œæˆè®°å½•<br>æ›´æ–°æµ‹è¯•èŒƒå›´ï¼ˆP0/P1/P2æ‰€æœ‰åŠŸèƒ½ï¼‰<br>æ·»åŠ æµ‹è¯•æ‰§è¡Œè®¡åˆ’ï¼ˆ6ä¸ªé˜¶æ®µï¼Œé¢„è®¡26å¤©ï¼‰ | AIåŠ©æ‰‹ |

### æµ‹è¯•è®¡åˆ’çŠ¶æ€

**åç«¯ä¸šåŠ¡åŠŸèƒ½æµ‹è¯•è®¡åˆ’**ï¼šâœ… å·²å®Œæˆ
- æµ‹è¯•è®¡åˆ’æ–‡æ¡£ï¼š`backend/åç«¯ä¸šåŠ¡åŠŸèƒ½æµ‹è¯•è®¡åˆ’.md`
- æµ‹è¯•ç”¨ä¾‹ç»Ÿè®¡ï¼šçº¦170ä¸ªæµ‹è¯•ç”¨ä¾‹
- æµ‹è¯•æ‰§è¡Œè®¡åˆ’ï¼š6ä¸ªé˜¶æ®µï¼Œé¢„è®¡26å¤©
- æµ‹è¯•éªŒæ”¶æ ‡å‡†ï¼šåŠŸèƒ½ã€æ€§èƒ½ã€å®‰å…¨

**å¾…æ‰§è¡Œæµ‹è¯•**ï¼š
- â³ å•å…ƒæµ‹è¯•ï¼ˆ3å¤©ï¼‰
- â³ é›†æˆæµ‹è¯•ï¼ˆ5å¤©ï¼‰
- â³ åŠŸèƒ½æµ‹è¯•ï¼ˆ7å¤©ï¼‰
- â³ æ€§èƒ½æµ‹è¯•ï¼ˆ3å¤©ï¼‰
- â³ ç¼ºé™·ä¿®å¤ï¼ˆ5å¤©ï¼‰
- â³ å›å½’æµ‹è¯•ï¼ˆ3å¤©ï¼‰

---