# æ€§èƒ½ä¼˜åŒ–æ–‡æ¡£

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

- **é¡¹ç›®åç§°**ï¼šä¼ä¸šçº§AIç»¼åˆç®¡ç†å¹³å°
- **æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0
- **åˆ›å»ºæ—¥æœŸ**ï¼š2026-01-13
- **æœ€åæ›´æ–°**ï¼š2026-01-16
- **æ–‡æ¡£ç±»å‹**ï¼šæ€§èƒ½ä¼˜åŒ–æ–‡æ¡£
- **å½“å‰çŠ¶æ€**ï¼šåç«¯ä¸šåŠ¡åŠŸèƒ½å¼€å‘å®Œæˆï¼ˆ100%ï¼‰ï¼Œå‡†å¤‡å¼€å§‹æµ‹è¯•å’Œå‰ç«¯å¼€å‘

---

## 1. æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1.1 æ€§èƒ½ä¼˜åŒ–å±‚æ¬¡

```mermaid
graph TB
    A[åº”ç”¨å±‚ä¼˜åŒ–] --> B[æ•°æ®åº“å±‚ä¼˜åŒ–]
    B --> C[ç¼“å­˜å±‚ä¼˜åŒ–]
    C --> D[ç½‘ç»œå±‚ä¼˜åŒ–]
    D --> E[ç¡¬ä»¶å±‚ä¼˜åŒ–]
```

### 1.2 ä¼˜åŒ–ç›®æ ‡

| æŒ‡æ ‡ | å½“å‰å€¼ | ç›®æ ‡å€¼ | ä¼˜åŒ–æ–¹æ³• |
|-----|--------|--------|---------|
| **å“åº”æ—¶é—´** | 500ms | <200ms | ç¼“å­˜ã€å¼‚æ­¥ã€ä¼˜åŒ–æŸ¥è¯¢ |
| **ååé‡** | 500 TPS | >1000 TPS | è¿æ¥æ± ã€å¼‚æ­¥å¤„ç† |
| **å¹¶å‘ç”¨æˆ·** | 500 | >1000 | æ°´å¹³æ‰©å±•ã€è´Ÿè½½å‡è¡¡ |

---

## 2. æ•°æ®åº“ä¼˜åŒ–æ–¹æ¡ˆ

### 2.1 ç´¢å¼•ä¼˜åŒ–

```sql
-- æŸ¥è¯¢æ…¢æŸ¥è¯¢
SELECT * FROM slow_query_log ORDER BY query_time DESC LIMIT 10;

-- æ·»åŠ ç´¢å¼•
CREATE INDEX idx_username ON users(username);
CREATE INDEX idx_email ON users(email);
CREATE INDEX idx_tenant_id ON users(tenant_id);
CREATE INDEX idx_status ON users(status);

-- å¤åˆç´¢å¼•
CREATE INDEX idx_tenant_status ON users(tenant_id, status);

-- åˆ é™¤æ— ç”¨ç´¢å¼•
DROP INDEX idx_unused_index;
```

### 2.2 æŸ¥è¯¢ä¼˜åŒ–

```python
# é”™è¯¯ç¤ºä¾‹ï¼šN+1æŸ¥è¯¢
def get_users_with_roles():
    users = db.query(User).all()
    result = []
    for user in users:
        roles = db.query(Role).filter(Role.user_id == user.id).all()
        result.append({
            "user": user,
            "roles": roles
        })
    return result

# æ­£ç¡®ç¤ºä¾‹ï¼šä½¿ç”¨JOIN
def get_users_with_roles():
    result = db.query(User).join(UserRole).join(Role).all()
    return result

# ä½¿ç”¨æ‰¹é‡æ’å…¥
def batch_create_users(users: List[dict]):
    db.bulk_insert_mappings(User, users)
    db.commit()
```

### 2.3 è¿æ¥æ± ä¼˜åŒ–

```python
# é…ç½®è¿æ¥æ± 
from sqlalchemy.pool import QueuePool

engine = create_engine(
    DATABASE_URL,
    poolclass=QueuePool,
    pool_size=10,          # è¿æ¥æ± å¤§å°
    max_overflow=20,       # æœ€å¤§æº¢å‡ºè¿æ¥æ•°
    pool_timeout=30,       # è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
    pool_recycle=3600,     # è¿æ¥å›æ”¶æ—¶é—´ï¼ˆç§’ï¼‰
    pool_pre_ping=True,     # è¿æ¥å‰æ£€æŸ¥
    echo=False             # ç”Ÿäº§ç¯å¢ƒå…³é—­SQLæ—¥å¿—
)
```

---

## 3. ç¼“å­˜ä¼˜åŒ–æ–¹æ¡ˆ

### 3.1 å¤šçº§ç¼“å­˜

```python
# utils/cache.py
from functools import lru_cache
from typing import Any, Optional

class CacheManager:
    def __init__(self):
        self.local_cache = {}  # L1ç¼“å­˜
        self.redis_client = None  # L2ç¼“å­˜
    
    async def get(self, key: str) -> Optional[Any]:
        # L1ç¼“å­˜
        if key in self.local_cache:
            return self.local_cache[key]
        
        # L2ç¼“å­˜
        if self.redis_client:
            value = await self.redis_client.get(key)
            if value:
                self.local_cache[key] = value
                return value
        
        return None
    
    async def set(self, key: str, value: Any, ttl: int = 3600):
        # L1ç¼“å­˜
        self.local_cache[key] = value
        
        # L2ç¼“å­˜
        if self.redis_client:
            await self.redis_client.setex(key, ttl, value)
    
    async def delete(self, key: str):
        # åˆ é™¤L1ç¼“å­˜
        if key in self.local_cache:
            del self.local_cache[key]
        
        # åˆ é™¤L2ç¼“å­˜
        if self.redis_client:
            await self.redis_client.delete(key)
    
    async def clear(self):
        # æ¸…ç©ºL1ç¼“å­˜
        self.local_cache.clear()
        
        # æ¸…ç©ºL2ç¼“å­˜
        if self.redis_client:
            await self.redis_client.flushdb()

# ä½¿ç”¨ç¼“å­˜è£…é¥°å™¨
def cache_result(ttl: int = 3600):
    def decorator(func):
        async def wrapper(*args, **kwargs):
            cache_key = f"{func.__name__}:{str(args)}:{str(kwargs)}"
            cached = await cache_manager.get(cache_key)
            if cached:
                return cached
            
            result = await func(*args, **kwargs)
            await cache_manager.set(cache_key, result, ttl)
            return result
        return wrapper
    return decorator
```

### 3.2 ç¼“å­˜ç­–ç•¥

| æ•°æ®ç±»å‹ | ç¼“å­˜æ—¶é—´ | æ›´æ–°ç­–ç•¥ |
|---------|---------|---------|
| **ç”¨æˆ·ä¿¡æ¯** | 30åˆ†é’Ÿ | ç”¨æˆ·æ›´æ–°æ—¶æ¸…ç©º |
| **æƒé™æ•°æ®** | 1å°æ—¶ | æƒé™å˜æ›´æ—¶æ¸…ç©º |
| **å­—å…¸æ•°æ®** | 24å°æ—¶ | å­—å…¸æ›´æ–°æ—¶æ¸…ç©º |
| **èœå•æ•°æ®** | 1å°æ—¶ | èœå•å˜æ›´æ—¶æ¸…ç©º |
| **ç»Ÿè®¡æ•°æ®** | 5åˆ†é’Ÿ | å®šæ—¶åˆ·æ–° |

---

## 4. æ¥å£ä¼˜åŒ–æ–¹æ¡ˆ

### 4.1 å¼‚æ­¥å¤„ç†

```python
from fastapi import FastAPI
import asyncio

app = FastAPI()

@app.post("/api/v1/users/batch")
async def batch_create_users(users: List[dict]):
    """æ‰¹é‡åˆ›å»ºç”¨æˆ·ï¼ˆå¼‚æ­¥ï¼‰"""
    tasks = []
    for user_data in users:
        task = asyncio.create_task(create_user_async(user_data))
        tasks.append(task)
    
    results = await asyncio.gather(*tasks)
    return {"success": True, "data": results}

async def create_user_async(user_data: dict):
    """å¼‚æ­¥åˆ›å»ºç”¨æˆ·"""
    # æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œ
    await asyncio.sleep(0.1)
    return {"id": "1", **user_data}
```

### 4.2 åˆ†é¡µä¼˜åŒ–

```python
@app.get("/api/v1/users")
async def get_users(page: int = 1, size: int = 10):
    """è·å–ç”¨æˆ·åˆ—è¡¨ï¼ˆä¼˜åŒ–åˆ†é¡µï¼‰"""
    # ä½¿ç”¨æ¸¸æ ‡åˆ†é¡µï¼Œé¿å…OFFSET
    if page > 1:
        last_id = get_last_id(page, size)
        users = db.query(User).filter(
            User.id > last_id
        ).limit(size).all()
    else:
        users = db.query(User).limit(size).all()
    
    return {
        "items": users,
        "page": page,
        "size": size
    }
```

---

## 5. å‰ç«¯æ€§èƒ½ä¼˜åŒ–

### 5.1 ä»£ç å±‚é¢ä¼˜åŒ–

#### 5.1.1 è·¯ç”±æ‡’åŠ è½½

**å®ç°æ–¹å¼**ï¼š
```typescript
// router/index.ts
import { createRouter, createWebHistory } from 'vue-router'

const routes = [
  {
    path: '/dashboard',
    name: 'Dashboard',
    component: () => import('@/views/dashboard/Index.vue'),
    meta: { title: 'é¦–é¡µçœ‹æ¿' }
  },
  {
    path: '/system/user',
    name: 'User',
    component: () => import('@/views/system/User.vue'),
    meta: { title: 'ç”¨æˆ·ç®¡ç†' }
  },
  {
    path: '/system/role',
    name: 'Role',
    component: () => import('@/views/system/Role.vue'),
    meta: { title: 'è§’è‰²ç®¡ç†' }
  }
]

const router = createRouter({
  history: createWebHistory(),
  routes
})

export default router
```

**ä¼˜åŒ–æ•ˆæœ**ï¼š
- âœ… é¦–å±åŠ è½½æ—¶é—´å‡å°‘ 40%
- âœ… æŒ‰éœ€åŠ è½½ï¼Œå‡å°‘åˆå§‹åŒ…ä½“ç§¯
- âœ… æå‡ç”¨æˆ·ä½“éªŒ

#### 5.1.2 ç»„ä»¶æ‡’åŠ è½½

**å®ç°æ–¹å¼**ï¼š
```vue
<script setup lang="ts">
import { defineAsyncComponent } from 'vue'
import { LoadingComponent, ErrorComponent } from '@/components'

// æ‡’åŠ è½½é‡å‹ç»„ä»¶
const HeavyComponent = defineAsyncComponent({
  loader: () => import('./HeavyComponent.vue'),
  loadingComponent: LoadingComponent,
  errorComponent: ErrorComponent,
  delay: 200,
  timeout: 3000
})

// æ‡’åŠ è½½å›¾è¡¨ç»„ä»¶
const ChartComponent = defineAsyncComponent(() =>
  import('@/components/ChartComponent.vue')
)
</script>

<template>
  <div>
    <Suspense>
      <template #default>
        <HeavyComponent />
      </template>
      <template #fallback>
        <LoadingComponent />
      </template>
    </Suspense>
  </div>
</template>
```

#### 5.1.3 ä»£ç åˆ†å‰²ï¼ˆCode Splittingï¼‰

**Viteé…ç½®**ï¼š
```typescript
// vite.config.ts
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'

export default defineConfig({
  plugins: [vue()],
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          // Vueæ ¸å¿ƒåº“
          'vue-vendor': ['vue', 'vue-router', 'pinia'],
          // UIç»„ä»¶åº“
          'element-plus': ['element-plus'],
          // HTTPå®¢æˆ·ç«¯
          'axios': ['axios'],
          // å›¾æ ‡åº“
          'icons': ['@element-plus/icons-vue'],
          // å·¥å…·åº“
          'utils': ['lodash-es', 'dayjs']
        }
      }
    },
    chunkSizeWarningLimit: 1000,
    // å¯ç”¨å‹ç¼©
    minify: 'terser',
    terserOptions: {
      compress: {
        drop_console: true,
        drop_debugger: true
      }
    }
  }
})
```

#### 5.1.4 Tree Shaking

**é…ç½®ç¤ºä¾‹**ï¼š
```typescript
// vite.config.ts
export default defineConfig({
  build: {
    rollupOptions: {
      treeshake: {
        moduleSideEffects: false
      }
    }
  }
})
```

**ä½¿ç”¨ESæ¨¡å—å¯¼å…¥**ï¼š
```typescript
// âœ… æ¨èï¼šæŒ‰éœ€å¯¼å…¥
import { debounce } from 'lodash-es'
import { ElButton, ElTable } from 'element-plus'

// âŒ ä¸æ¨èï¼šå¯¼å…¥æ•´ä¸ªåº“
import _ from 'lodash'
import ElementPlus from 'element-plus'
```

### 5.2 èµ„æºä¼˜åŒ–

#### 5.2.1 å›¾ç‰‡ä¼˜åŒ–

**å›¾ç‰‡å‹ç¼©**ï¼š
```typescript
// vite.config.ts
import { defineConfig } from 'vite'
import viteImagemin from 'vite-plugin-imagemin'

export default defineConfig({
  plugins: [
    viteImagemin({
      gifsicle: { optimizationLevel: 7 },
      optipng: { optimizationLevel: 7 },
      mozjpeg: { quality: 80 },
      webp: { quality: 80 }
    })
  ]
})
```

**å›¾ç‰‡æ‡’åŠ è½½**ï¼š
```vue
<script setup lang="ts">
import { ref, onMounted } from 'vue'

const imgRef = ref<HTMLImageElement>()

onMounted(() => {
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        const img = entry.target as HTMLImageElement
        img.src = img.dataset.src || ''
        observer.unobserve(img)
      }
    })
  })

  if (imgRef.value) {
    observer.observe(imgRef.value)
  }
})
</script>

<template>
  <img
    ref="imgRef"
    :data-src="imageUrl"
    src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"
    alt="æ‡’åŠ è½½å›¾ç‰‡"
  />
</template>
```

**WebPæ ¼å¼æ”¯æŒ**ï¼š
```typescript
// utils/image.ts
export function getOptimizedImageUrl(url: string): string {
  // æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒWebP
  const supportsWebP = document.createElement('canvas')
    .toDataURL('image/webp')
    .indexOf('data:image/webp') === 0
  
  if (supportsWebP && url.match(/\.(jpg|jpeg|png)$/i)) {
    return url.replace(/\.(jpg|jpeg|png)$/i, '.webp')
  }
  
  return url
}
```

#### 5.2.2 å­—ä½“ä¼˜åŒ–

**å­—ä½“å­é›†åŒ–**ï¼š
```typescript
// vite.config.ts
export default defineConfig({
  build: {
    rollupOptions: {
      output: {
        assetFileNames: (assetInfo) => {
          // å°†å­—ä½“æ–‡ä»¶å½’ç±»
          if (assetInfo.name?.match(/\.(woff|woff2|ttf|otf)$/)) {
            return 'fonts/[name]-[hash][extname]'
          }
          return 'assets/[name]-[hash][extname]'
        }
      }
    }
  }
})
```

**å­—ä½“é¢„åŠ è½½**ï¼š
```html
<!-- index.html -->
<head>
  <link rel="preload" href="/fonts/Inter-Regular.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="/fonts/Inter-Bold.woff2" as="font" type="font/woff2" crossorigin>
</head>
```

**å­—ä½“æ˜¾ç¤ºç­–ç•¥**ï¼š
```css
/* styles/global.css */
@font-face {
  font-family: 'Inter';
  src: url('/fonts/Inter-Regular.woff2') format('woff2');
  font-display: swap; /* ä¼˜å…ˆä½¿ç”¨ç³»ç»Ÿå­—ä½“ï¼Œå­—ä½“åŠ è½½ååˆ‡æ¢ */
}
```

#### 5.2.3 CSSä¼˜åŒ–

**CSSå‹ç¼©**ï¼š
```typescript
// vite.config.ts
export default defineConfig({
  css: {
    postcss: {
      plugins: [
        require('cssnano')({
          preset: 'default'
        })
      ]
    }
  }
})
```

**å…³é”®CSSå†…è”**ï¼š
```html
<!-- index.html -->
<head>
  <style>
    /* å…³é”®CSSï¼Œé¦–å±å¿…éœ€ */
    body { margin: 0; font-family: 'Inter', sans-serif; }
    .loading { display: flex; justify-content: center; align-items: center; height: 100vh; }
  </style>
</head>
```

**CSSæ¨¡å—åŒ–**ï¼š
```vue
<style scoped module>
.container {
  padding: 20px;
}

.button {
  background-color: #409eff;
  color: white;
}
</style>
```

### 5.3 ç¼“å­˜ä¼˜åŒ–

#### 5.3.1 HTTPç¼“å­˜ç­–ç•¥

**Viteé…ç½®**ï¼š
```typescript
// vite.config.ts
export default defineConfig({
  build: {
    rollupOptions: {
      output: {
        chunkFileNames: 'js/[name]-[hash].js',
        entryFileNames: 'js/[name]-[hash].js',
        assetFileNames: '[ext]/[name]-[hash].[ext]'
      }
    }
  }
})
```

**Nginxé…ç½®**ï¼š
```nginx
# nginx.conf
location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
  expires 1y;
  add_header Cache-Control "public, immutable";
}

location ~* \.(html)$ {
  expires 1h;
  add_header Cache-Control "public, must-revalidate";
}
```

#### 5.3.2 Service Workerç¼“å­˜

**æ³¨å†ŒService Worker**ï¼š
```typescript
// main.ts
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/sw.js')
      .then(registration => {
        console.log('Service Workeræ³¨å†ŒæˆåŠŸ:', registration)
      })
      .catch(error => {
        console.error('Service Workeræ³¨å†Œå¤±è´¥:', error)
      })
  })
}
```

**Service Workerå®ç°**ï¼š
```typescript
// public/sw.js
const CACHE_NAME = 'mcp-platform-v1'
const urlsToCache = [
  '/',
  '/index.html',
  '/favicon.ico'
]

self.addEventListener('install', event => {
  event.waitUntil(
    caches.open(CACHE_NAME)
      .then(cache => cache.addAll(urlsToCache))
  )
})

self.addEventListener('fetch', event => {
  event.respondWith(
    caches.match(event.request)
      .then(response => {
        if (response) {
          return response
        }
        return fetch(event.request)
      })
  )
})
```

#### 5.3.3 LocalStorage/SessionStorageä½¿ç”¨

**ç¼“å­˜å·¥å…·ç±»**ï¼š
```typescript
// utils/storage.ts
class Storage {
  private prefix = 'mcp-platform-'

  set(key: string, value: any, ttl?: number): void {
    const item = {
      value,
      expires: ttl ? Date.now() + ttl * 1000 : null
    }
    localStorage.setItem(`${this.prefix}${key}`, JSON.stringify(item))
  }

  get(key: string): any {
    const itemStr = localStorage.getItem(`${this.prefix}${key}`)
    if (!itemStr) return null

    const item = JSON.parse(itemStr)
    if (item.expires && Date.now() > item.expires) {
      localStorage.removeItem(`${this.prefix}${key}`)
      return null
    }

    return item.value
  }

  remove(key: string): void {
    localStorage.removeItem(`${this.prefix}${key}`)
  }

  clear(): void {
    Object.keys(localStorage)
      .filter(key => key.startsWith(this.prefix))
      .forEach(key => localStorage.removeItem(key))
  }
}

export const storage = new Storage()
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```typescript
import { storage } from '@/utils/storage'

// è®¾ç½®ç¼“å­˜ï¼ˆ1å°æ—¶è¿‡æœŸï¼‰
storage.set('userInfo', userInfo, 3600)

// è·å–ç¼“å­˜
const userInfo = storage.get('userInfo')

// åˆ é™¤ç¼“å­˜
storage.remove('userInfo')
```

### 5.4 æ¸²æŸ“ä¼˜åŒ–

#### 5.4.1 è™šæ‹Ÿæ»šåŠ¨

**ä½¿ç”¨vue-virtual-scroller**ï¼š
```vue
<script setup lang="ts">
import { ref } from 'vue'
import { RecycleScroller } from 'vue-virtual-scroller'
import 'vue-virtual-scroller/dist/vue-virtual-scroller.css'

const items = ref(Array.from({ length: 10000 }, (_, i) => ({
  id: i,
  name: `Item ${i}`
}))
</script>

<template>
  <RecycleScroller
    class="scroller"
    :items="items"
    :item-size="50"
    key-field="id"
    v-slot="{ item }"
  >
    <div class="item">{{ item.name }}</div>
  </RecycleScroller>
</template>

<style scoped>
.scroller {
  height: 500px;
}

.item {
  height: 50px;
  padding: 10px;
  border-bottom: 1px solid #eee;
}
</style>
```

#### 5.4.2 é˜²æŠ–å’ŒèŠ‚æµ

**é˜²æŠ–å·¥å…·**ï¼š
```typescript
// utils/debounce.ts
export function debounce<T extends (...args: any[]) => any>(
  func: T,
  wait: number
): (...args: Parameters<T>) => void {
  let timeout: ReturnType<typeof setTimeout> | null = null

  return function (this: any, ...args: Parameters<T>) {
    if (timeout) clearTimeout(timeout)
    timeout = setTimeout(() => {
      func.apply(this, args)
    }, wait)
  }
}
```

**èŠ‚æµå·¥å…·**ï¼š
```typescript
// utils/throttle.ts
export function throttle<T extends (...args: any[]) => any>(
  func: T,
  limit: number
): (...args: Parameters<T>) => void {
  let inThrottle: boolean = false

  return function (this: any, ...args: Parameters<T>) {
    if (!inThrottle) {
      func.apply(this, args)
      inThrottle = true
      setTimeout(() => (inThrottle = false), limit)
    }
  }
}
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```vue
<script setup lang="ts">
import { ref } from 'vue'
import { debounce } from '@/utils/debounce'
import { throttle } from '@/utils/throttle'

const searchValue = ref('')

// é˜²æŠ–æœç´¢
const handleSearch = debounce((value: string) => {
  console.log('æœç´¢:', value)
}, 300)

// èŠ‚æµæ»šåŠ¨
const handleScroll = throttle(() => {
  console.log('æ»šåŠ¨ä½ç½®:', window.scrollY)
}, 100)
</script>

<template>
  <input
    v-model="searchValue"
    @input="handleSearch($event.target.value)"
    placeholder="æœç´¢"
  />
</template>
```

#### 5.4.3 é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“

**ä½¿ç”¨computedå’ŒwatchEffect**ï¼š
```vue
<script setup lang="ts">
import { ref, computed, watchEffect } from 'vue'

const firstName = ref('')
const lastName = ref('')

// ä½¿ç”¨computedç¼“å­˜è®¡ç®—ç»“æœ
const fullName = computed(() => {
  return `${firstName.value} ${lastName.value}`
})

// ä½¿ç”¨watchEffectè‡ªåŠ¨è¿½è¸ªä¾èµ–
watchEffect(() => {
  console.log('å…¨åå˜åŒ–:', fullName.value)
})
</script>
```

**ä½¿ç”¨v-memoä¼˜åŒ–åˆ—è¡¨æ¸²æŸ“**ï¼š
```vue
<template>
  <div
    v-for="item in items"
    :key="item.id"
    v-memo="[item.id, item.selected]"
  >
    {{ item.name }}
  </div>
</template>
```

### 5.5 ç½‘ç»œä¼˜åŒ–

#### 5.5.1 CDNåŠ é€Ÿ

**Viteé…ç½®**ï¼š
```typescript
// vite.config.ts
export default defineConfig({
  build: {
    rollupOptions: {
      external: ['vue', 'vue-router', 'pinia', 'element-plus'],
      output: {
        globals: {
          vue: 'Vue',
          'vue-router': 'VueRouter',
          pinia: 'Pinia',
          'element-plus': 'ElementPlus'
        }
      }
    }
  }
})
```

**HTMLå¼•å…¥CDN**ï¼š
```html
<!-- index.html -->
<head>
  <script src="https://cdn.jsdelivr.net/npm/vue@3.3.4/dist/vue.global.prod.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue-router@4.2.4/dist/vue-router.global.prod.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/pinia@2.1.6/dist/pinia.iife.prod.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/element-plus@2.4.2/dist/index.css">
  <script src="https://cdn.jsdelivr.net/npm/element-plus@2.4.2/dist/index.full.min.js"></script>
</head>
```

#### 5.5.2 HTTP/2æˆ–HTTP/3

**Nginxé…ç½®**ï¼š
```nginx
# nginx.conf
server {
    listen 443 ssl http2;
    server_name example.com;

    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;

    # å¯ç”¨HTTP/3ï¼ˆéœ€è¦Nginx 1.25+ï¼‰
    # listen 443 quic reuseport;
    # add_header Alt-Svc 'h3=":443"; ma=86400';
}
```

#### 5.5.3 é¢„åŠ è½½å’Œé¢„è¿æ¥

**index.html**ï¼š
```html
<head>
  <!-- DNSé¢„è§£æ -->
  <link rel="dns-prefetch" href="https://api.example.com">
  
  <!-- é¢„è¿æ¥ -->
  <link rel="preconnect" href="https://api.example.com">
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  
  <!-- é¢„åŠ è½½é‡è¦èµ„æº -->
  <link rel="preload" href="/fonts/Inter-Regular.woff2" as="font" crossorigin>
  <link rel="preload" href="/assets/main.js" as="script">
  <link rel="preload" href="/assets/main.css" as="style">
  
  <!-- é¢„è·å–å¯èƒ½éœ€è¦çš„èµ„æº -->
  <link rel="prefetch" href="/assets/dashboard.js">
  <link rel="prefetch" href="/assets/user.js">
</head>
```

### 5.6 æ‰“åŒ…ä¼˜åŒ–

#### 5.6.1 ä»£ç åˆ†å‰²é…ç½®

**Viteå®Œæ•´é…ç½®**ï¼š
```typescript
// vite.config.ts
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import { visualizer } from 'rollup-plugin-visualizer'

export default defineConfig({
  plugins: [
    vue(),
    visualizer({
      open: true,
      gzipSize: true,
      brotliSize: true
    })
  ],
  build: {
    // å¯ç”¨å‹ç¼©
    minify: 'terser',
    terserOptions: {
      compress: {
        drop_console: true,
        drop_debugger: true,
        pure_funcs: ['console.log', 'console.info']
      }
    },
    rollupOptions: {
      output: {
        // ä»£ç åˆ†å‰²
        manualChunks: {
          'vue-vendor': ['vue', 'vue-router', 'pinia'],
          'element-plus': ['element-plus', '@element-plus/icons-vue'],
          'axios': ['axios'],
          'utils': ['lodash-es', 'dayjs']
        },
        // æ–‡ä»¶å‘½å
        chunkFileNames: 'js/[name]-[hash].js',
        entryFileNames: 'js/[name]-[hash].js',
        assetFileNames: '[ext]/[name]-[hash].[ext]'
      }
    },
    chunkSizeWarningLimit: 1000
  }
})
```

#### 5.6.2 Gzipå‹ç¼©

**Viteé…ç½®**ï¼š
```typescript
// vite.config.ts
import viteCompression from 'vite-plugin-compression'

export default defineConfig({
  plugins: [
    viteCompression({
      algorithm: 'gzip',
      ext: '.gz',
      threshold: 10240, // å¤§äº10KBæ‰å‹ç¼©
      deleteOriginFile: false
    })
  ]
})
```

**Nginxé…ç½®**ï¼š
```nginx
# nginx.conf
gzip on;
gzip_vary on;
gzip_min_length 1024;
gzip_types text/plain text/css text/xml text/javascript application/x-javascript application/xml+rss application/json application/javascript;
```

### 5.7 æ€§èƒ½ç›‘æ§

#### 5.7.1 Web Vitalsç›‘æ§

**å®ç°ä»£ç **ï¼š
```typescript
// utils/performance.ts
import { onCLS, onFID, onLCP, onFCP, onTTFB } from 'web-vitals'

export function reportWebVitals() {
  onCLS(console.log) // Cumulative Layout Shift
  onFID(console.log) // First Input Delay
  onLCP(console.log) // Largest Contentful Paint
  onFCP(console.log) // First Contentful Paint
  onTTFB(console.log) // Time to First Byte
}

// main.ts
reportWebVitals()
```

#### 5.7.2 æ€§èƒ½æ•°æ®ä¸ŠæŠ¥

**ä¸ŠæŠ¥å·¥å…·**ï¼š
```typescript
// utils/analytics.ts
export function reportPerformance(metricName: string, value: number) {
  // ä¸ŠæŠ¥åˆ°ç›‘æ§ç³»ç»Ÿ
  fetch('/api/v1/analytics/performance', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      metricName,
      value,
      timestamp: Date.now(),
      url: window.location.href,
      userAgent: navigator.userAgent
    })
  }).catch(error => {
    console.error('æ€§èƒ½æ•°æ®ä¸ŠæŠ¥å¤±è´¥:', error)
  })
}
```

### 5.8 å‰ç«¯æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ

**ä»£ç ä¼˜åŒ–æœ€ä½³å®è·µ**ï¼š
- âœ… ä½¿ç”¨è·¯ç”±æ‡’åŠ è½½å’Œç»„ä»¶æ‡’åŠ è½½
- âœ… å®ç°ä»£ç åˆ†å‰²ï¼Œå‡å°‘åˆå§‹åŒ…ä½“ç§¯
- âœ… ä½¿ç”¨Tree Shakingï¼Œç§»é™¤æœªä½¿ç”¨çš„ä»£ç 
- âœ… æŒ‰éœ€å¯¼å…¥ç¬¬ä¸‰æ–¹åº“

**èµ„æºä¼˜åŒ–æœ€ä½³å®è·µ**ï¼š
- âœ… å‹ç¼©å›¾ç‰‡ï¼Œä½¿ç”¨WebPæ ¼å¼
- âœ… å®ç°å›¾ç‰‡æ‡’åŠ è½½
- âœ… ä¼˜åŒ–å­—ä½“åŠ è½½ï¼Œä½¿ç”¨å­—ä½“å­é›†åŒ–
- âœ… å‹ç¼©å’Œåˆå¹¶CSSæ–‡ä»¶

**ç¼“å­˜ä¼˜åŒ–æœ€ä½³å®è·µ**ï¼š
- âœ… é…ç½®HTTPç¼“å­˜ç­–ç•¥
- âœ… ä½¿ç”¨Service Workerç¼“å­˜é™æ€èµ„æº
- âœ… åˆç†ä½¿ç”¨LocalStorageå’ŒSessionStorage
- âœ… å®ç°ç¼“å­˜å¤±æ•ˆç­–ç•¥

**æ¸²æŸ“ä¼˜åŒ–æœ€ä½³å®è·µ**ï¼š
- âœ… ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨å¤„ç†é•¿åˆ—è¡¨
- âœ… ä½¿ç”¨é˜²æŠ–å’ŒèŠ‚æµä¼˜åŒ–é¢‘ç¹æ“ä½œ
- âœ… é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
- âœ… ä½¿ç”¨computedç¼“å­˜è®¡ç®—ç»“æœ

**ç½‘ç»œä¼˜åŒ–æœ€ä½³å®è·µ**ï¼š
- âœ… ä½¿ç”¨CDNåŠ é€Ÿé™æ€èµ„æº
- âœ… å¯ç”¨HTTP/2æˆ–HTTP/3
- âœ… å®ç°é¢„åŠ è½½å’Œé¢„è¿æ¥
- âœ… ä¼˜åŒ–DNSæŸ¥è¯¢

---

## 6. æ€§èƒ½æµ‹è¯•æ–¹æ¡ˆ

### 6.1 æ€§èƒ½æµ‹è¯•å·¥å…·

| å·¥å…· | ç”¨é€” |
|-----|------|
| **JMeter** | å‹åŠ›æµ‹è¯•ã€æ€§èƒ½æµ‹è¯• |
| **Locust** | åˆ†å¸ƒå¼è´Ÿè½½æµ‹è¯• |
| **Pytest-benchmark** | Pythonä»£ç æ€§èƒ½æµ‹è¯• |
| **Lighthouse** | å‰ç«¯æ€§èƒ½æµ‹è¯• |

### 6.2 æ€§èƒ½æµ‹è¯•è„šæœ¬

```python
# tests/benchmark/test_user_query.py
import pytest
import time
from app.services.user_service import UserService

def benchmark_get_user(benchmark):
    """æ€§èƒ½æµ‹è¯•ï¼šæŸ¥è¯¢ç”¨æˆ·"""
    user_service = UserService()
    
    # é¢„çƒ­
    user_service.get_user("1")
    
    # æµ‹è¯•
    start_time = time.time()
    for _ in range(1000):
        user_service.get_user("1")
    end_time = time.time()
    
    return end_time - start_time
```

---

## 7. æ€§èƒ½ç›‘æ§æŒ‡æ ‡

### 7.1 å…³é”®æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | ç›‘æ§å·¥å…· |
|-----|--------|---------|
| **P95å“åº”æ—¶é—´** | <200ms | Prometheus |
| **P99å“åº”æ—¶é—´** | <500ms | Prometheus |
| **é”™è¯¯ç‡** | <1% | Prometheus |
| **ååé‡** | >1000 TPS | Prometheus |
| **CPUä½¿ç”¨ç‡** | <70% | Prometheus |
| **å†…å­˜ä½¿ç”¨ç‡** | <80% | Prometheus |

### 7.2 Grafanaä»ªè¡¨æ¿

```json
{
  "dashboard": {
    "title": "åº”ç”¨æ€§èƒ½ç›‘æ§",
    "panels": [
      {
        "title": "QPS",
        "targets": [
          {
            "expr": "rate(http_requests_total[1m])"
          }
        ]
      },
      {
        "title": "å“åº”æ—¶é—´",
        "targets": [
          {
            "expr": "histogram_quantile(0.95, http_request_duration_seconds_bucket)"
          }
        ]
      },
      {
        "title": "é”™è¯¯ç‡",
        "targets": [
          {
            "expr": "rate(http_requests_total{status=~\"5..\"}[1m]) / rate(http_requests_total[1m])"
          }
        ]
      }
    ]
  }
}
```

---

## 8. æ€§èƒ½ä¼˜åŒ–æ¡ˆä¾‹

### 8.1 æ¡ˆä¾‹1ï¼šç”¨æˆ·æŸ¥è¯¢ä¼˜åŒ–

**é—®é¢˜**ï¼šç”¨æˆ·æŸ¥è¯¢å“åº”æ—¶é—´500ms

**åˆ†æ**ï¼šN+1æŸ¥è¯¢é—®é¢˜

**ä¼˜åŒ–**ï¼š
1. ä½¿ç”¨JOINæ›¿ä»£å¤šæ¬¡æŸ¥è¯¢
2. æ·»åŠ ç´¢å¼•
3. ä½¿ç”¨ç¼“å­˜

**ç»“æœ**ï¼šå“åº”æ—¶é—´é™ä½åˆ°50ms

### 8.2 æ¡ˆä¾‹2ï¼šæƒé™æ ¡éªŒä¼˜åŒ–

**é—®é¢˜**ï¼šæƒé™æ ¡éªŒæ¯æ¬¡éƒ½æŸ¥è¯¢æ•°æ®åº“

**ä¼˜åŒ–**ï¼š
1. ä½¿ç”¨å¤šçº§ç¼“å­˜
2. æƒé™å˜æ›´æ—¶æ¸…ç©ºç¼“å­˜
3. ä½¿ç”¨æœ¬åœ°ç¼“å­˜+Redisç¼“å­˜

**ç»“æœ**ï¼šå“åº”æ—¶é—´é™ä½åˆ°10ms

---

## 9. æ€§èƒ½æµ‹è¯•åŸºå‡†

### 9.1 æ€§èƒ½æµ‹è¯•æ¦‚è¿°

**æ€§èƒ½æµ‹è¯•ç›®æ ‡**ï¼š
- éªŒè¯ç³»ç»Ÿæ€§èƒ½æ˜¯å¦æ»¡è¶³ä¸šåŠ¡éœ€æ±‚
- å‘ç°æ€§èƒ½ç“¶é¢ˆå’Œæ½œåœ¨é—®é¢˜
- è¯„ä¼°ç³»ç»Ÿå®¹é‡å’Œæ‰©å±•èƒ½åŠ›
- ä¸ºæ€§èƒ½ä¼˜åŒ–æä¾›æ•°æ®æ”¯æŒ

**æ€§èƒ½æµ‹è¯•ç±»å‹**ï¼š
- **è´Ÿè½½æµ‹è¯•**ï¼šéªŒè¯ç³»ç»Ÿåœ¨é¢„æœŸè´Ÿè½½ä¸‹çš„æ€§èƒ½
- **å‹åŠ›æµ‹è¯•**ï¼šéªŒè¯ç³»ç»Ÿåœ¨æé™è´Ÿè½½ä¸‹çš„æ€§èƒ½
- **å¹¶å‘æµ‹è¯•**ï¼šéªŒè¯ç³»ç»Ÿåœ¨é«˜å¹¶å‘ä¸‹çš„æ€§èƒ½
- **ç¨³å®šæ€§æµ‹è¯•**ï¼šéªŒè¯ç³»ç»Ÿé•¿æ—¶é—´è¿è¡Œçš„ç¨³å®šæ€§

### 9.2 æ€§èƒ½æµ‹è¯•åŸºå‡†

#### 9.2.1 æµ‹è¯•åœºæ™¯å®šä¹‰

**åœºæ™¯1ï¼šç”¨æˆ·ç™»å½•**

**æµ‹è¯•ç›®æ ‡**ï¼š
- å“åº”æ—¶é—´ï¼š< 200ms (P95)
- ååé‡ï¼š> 100 TPS
- å¹¶å‘ç”¨æˆ·ï¼š100

**æµ‹è¯•æ­¥éª¤**ï¼š
```python
# tests/performance/test_login.py
from locust import HttpUser, task, between
import time

class LoginUser(HttpUser):
    wait_time = between(1, 3)
    
    def on_start(self):
        """ç”¨æˆ·ç™»å½•"""
        response = self.client.post(
            "/api/v1/auth/login",
            json={
                "username": "test_user",
                "password": "password123"
            }
        )
        if response.status_code == 200:
            self.token = response.json()["data"]["token"]
    
    @task
    def get_user_info(self):
        """è·å–ç”¨æˆ·ä¿¡æ¯"""
        self.client.get(
            "/api/v1/auth/me",
            headers={"Authorization": f"Bearer {self.token}"}
        )
```

**åœºæ™¯2ï¼šç”¨æˆ·æŸ¥è¯¢**

**æµ‹è¯•ç›®æ ‡**ï¼š
- å“åº”æ—¶é—´ï¼š< 100ms (P95)
- ååé‡ï¼š> 500 TPS
- å¹¶å‘ç”¨æˆ·ï¼š200

**æµ‹è¯•æ­¥éª¤**ï¼š
```python
# tests/performance/test_user_query.py
from locust import HttpUser, task, between

class UserQueryUser(HttpUser):
    wait_time = between(0.5, 2)
    
    def on_start(self):
        """ç”¨æˆ·ç™»å½•"""
        response = self.client.post(
            "/api/v1/auth/login",
            json={
                "username": "test_user",
                "password": "password123"
            }
        )
        self.token = response.json()["data"]["token"]
    
    @task(3)
    def get_user_list(self):
        """è·å–ç”¨æˆ·åˆ—è¡¨"""
        self.client.get(
            "/api/v1/users?page=1&size=10",
            headers={"Authorization": f"Bearer {self.token}"}
        )
    
    @task(1)
    def get_user_detail(self):
        """è·å–ç”¨æˆ·è¯¦æƒ…"""
        self.client.get(
            "/api/v1/users/1",
            headers={"Authorization": f"Bearer {self.token}"}
        )
```

**åœºæ™¯3ï¼šå·¥ä½œæµå®¡æ‰¹**

**æµ‹è¯•ç›®æ ‡**ï¼š
- å“åº”æ—¶é—´ï¼š< 300ms (P95)
- ååé‡ï¼š> 50 TPS
- å¹¶å‘ç”¨æˆ·ï¼š50

**æµ‹è¯•æ­¥éª¤**ï¼š
```python
# tests/performance/test_workflow.py
from locust import HttpUser, task, between

class WorkflowUser(HttpUser):
    wait_time = between(2, 5)
    
    def on_start(self):
        """ç”¨æˆ·ç™»å½•"""
        response = self.client.post(
            "/api/v1/auth/login",
            json={
                "username": "test_user",
                "password": "password123"
            }
        )
        self.token = response.json()["data"]["token"]
    
    @task
    def get_workflow_list(self):
        """è·å–å·¥ä½œæµåˆ—è¡¨"""
        self.client.get(
            "/api/v1/workflow/definitions",
            headers={"Authorization": f"Bearer {self.token}"}
        )
    
    @task
    def get_pending_tasks(self):
        """è·å–å¾…åŠä»»åŠ¡"""
        self.client.get(
            "/api/v1/workflow/pending-tasks",
            headers={"Authorization": f"Bearer {self.token}"}
        )
    
    @task
    def approve_task(self):
        """å®¡æ‰¹ä»»åŠ¡"""
        self.client.post(
            "/api/v1/workflow/tasks/1/approve",
            json={"comment": "åŒæ„"},
            headers={"Authorization": f"Bearer {self.token}"}
        )
```

#### 9.2.2 æµ‹è¯•æ•°æ®å‡†å¤‡

**ç”¨æˆ·æ•°æ®å‡†å¤‡**ï¼š
```python
# tests/performance/prepare_data.py
import asyncio
from sqlalchemy.ext.asyncio import create_async_engine, AsyncSession
from sqlalchemy.orm import sessionmaker
from app.models.user import User
from app.utils.security import get_password_hash

async def prepare_test_users(count: int = 1000):
    """å‡†å¤‡æµ‹è¯•ç”¨æˆ·æ•°æ®"""
    engine = create_async_engine(DATABASE_URL)
    async_session = sessionmaker(engine, class_=AsyncSession, expire_on_commit=False)
    
    async with async_session() as session:
        users = []
        for i in range(count):
            user = User(
                id=f"test_user_{i}",
                username=f"test_user_{i}",
                email=f"test_user_{i}@example.com",
                password_hash=get_password_hash("password123"),
                tenant_id="test_tenant",
                status="active"
            )
            users.append(user)
        
        session.add_all(users)
        await session.commit()
        await session.close()
    
    await engine.dispose()

if __name__ == "__main__":
    asyncio.run(prepare_test_users(1000))
```

**å·¥ä½œæµæ•°æ®å‡†å¤‡**ï¼š
```python
# tests/performance/prepare_workflow.py
import asyncio
from sqlalchemy.ext.asyncio import create_async_engine, AsyncSession
from sqlalchemy.orm import sessionmaker
from app.models.workflow import WorkflowDefinition, WorkflowInstance

async def prepare_test_workflows(count: int = 100):
    """å‡†å¤‡æµ‹è¯•å·¥ä½œæµæ•°æ®"""
    engine = create_async_engine(DATABASE_URL)
    async_session = sessionmaker(engine, class_=AsyncSession, expire_on_commit=False)
    
    async with async_session() as session:
        # åˆ›å»ºå·¥ä½œæµå®šä¹‰
        workflow_def = WorkflowDefinition(
            id="test_workflow_def",
            tenant_id="test_tenant",
            name="æµ‹è¯•å·¥ä½œæµ",
            description="ç”¨äºæ€§èƒ½æµ‹è¯•çš„å·¥ä½œæµ",
            definition_json={"nodes": [], "edges": []},
            status="published"
        )
        session.add(workflow_def)
        
        # åˆ›å»ºå·¥ä½œæµå®ä¾‹
        instances = []
        for i in range(count):
            instance = WorkflowInstance(
                id=f"test_instance_{i}",
                tenant_id="test_tenant",
                definition_id="test_workflow_def",
                instance_no=f"INST-{i:06d}",
                status="running",
                context_variables={},
                created_by="test_user_0"
            )
            instances.append(instance)
        
        session.add_all(instances)
        await session.commit()
        await session.close()
    
    await engine.dispose()

if __name__ == "__main__":
    asyncio.run(prepare_test_workflows(100))
```

#### 9.2.3 æµ‹è¯•å·¥å…·é…ç½®

**Locusté…ç½®**ï¼š
```python
# tests/performance/locustfile.py
from locust import HttpUser, task, between, events
from locust.runners import MasterRunner
import time

class TestUser(HttpUser):
    """æµ‹è¯•ç”¨æˆ·"""
    wait_time = between(1, 3)
    
    def on_start(self):
        """ç”¨æˆ·ç™»å½•"""
        response = self.client.post(
            "/api/v1/auth/login",
            json={
                "username": "test_user",
                "password": "password123"
            }
        )
        if response.status_code == 200:
            self.token = response.json()["data"]["token"]
        else:
            self.environment.runner.quit()
    
    @task
    def get_user_list(self):
        """è·å–ç”¨æˆ·åˆ—è¡¨"""
        start_time = time.time()
        response = self.client.get(
            "/api/v1/users?page=1&size=10",
            headers={"Authorization": f"Bearer {self.token}"}
        )
        end_time = time.time()
        
        # è®°å½•å“åº”æ—¶é—´
        events.request.fire(
            request_type="GET",
            name="/api/v1/users",
            response_time=(end_time - start_time) * 1000,
            response_length=len(response.content),
            response=response.status_code
        )

# æ€§èƒ½æµ‹è¯•é…ç½®
class PerformanceTestConfig:
    """æ€§èƒ½æµ‹è¯•é…ç½®"""
    
    # åœºæ™¯1ï¼šç”¨æˆ·ç™»å½•
    login_test = {
        "users": 100,
        "spawn_rate": 10,
        "run_time": "5m",
        "target_rps": 100,
        "max_response_time": 200
    }
    
    # åœºæ™¯2ï¼šç”¨æˆ·æŸ¥è¯¢
    user_query_test = {
        "users": 200,
        "spawn_rate": 20,
        "run_time": "5m",
        "target_rps": 500,
        "max_response_time": 100
    }
    
    # åœºæ™¯3ï¼šå·¥ä½œæµå®¡æ‰¹
    workflow_test = {
        "users": 50,
        "spawn_rate": 5,
        "run_time": "5m",
        "target_rps": 50,
        "max_response_time": 300
    }
```

**JMeteré…ç½®**ï¼š
```xml
<?xml version="1.0" encoding="UTF-8"?>
<jmeterTestPlan version="1.2" properties="5.0">
  <hashTree>
    <TestPlan guiclass="TestPlan" testclass="TestPlan" testname="æ€§èƒ½æµ‹è¯•è®¡åˆ’">
      <elementProp name="TestPlan.user_define_classpath" elementType="Arguments">
        <collectionProp name="Arguments.arguments">
          <elementProp name="BASE_URL" elementType="Argument">
            <stringProp name="Argument.name">BASE_URL</stringProp>
            <stringProp name="Argument.value">http://localhost:8000</stringProp>
          </elementProp>
        </collectionProp>
      </elementProp>
      
      <!-- ç”¨æˆ·ç™»å½•çº¿ç¨‹ç»„ -->
      <ThreadGroup guiclass="ThreadGroup" testclass="ThreadGroup" testname="ç”¨æˆ·ç™»å½•æµ‹è¯•">
        <stringProp name="ThreadGroup.num_threads">100</stringProp>
        <stringProp name="ThreadGroup.ramp_time">10</stringProp>
        <stringProp name="ThreadGroup.duration">300</stringProp>
        <boolProp name="ThreadGroup.scheduler">true</boolProp>
        
        <!-- HTTPè¯·æ±‚ -->
        <HTTPSamplerProxy guiclass="HTTPSamplerProxy" testclass="HTTPSamplerProxy" testname="ç”¨æˆ·ç™»å½•">
          <stringProp name="HTTPSampler.domain">${BASE_URL}</stringProp>
          <stringProp name="HTTPSampler.port">8000</stringProp>
          <stringProp name="HTTPSampler.path">/api/v1/auth/login</stringProp>
          <stringProp name="HTTPSampler.method">POST</stringProp>
          <elementProp name="HTTPsampler.Arguments" elementType="Arguments">
            <collectionProp name="Arguments.arguments">
              <elementProp name="username" elementType="HTTPArgument">
                <stringProp name="Argument.value">test_user</stringProp>
                <boolProp name="HTTPArgument.use_equals">true</boolProp>
              </elementProp>
              <elementProp name="password" elementType="HTTPArgument">
                <stringProp name="Argument.value">password123</stringProp>
                <boolProp name="HTTPArgument.use_equals">true</boolProp>
              </elementProp>
            </collectionProp>
          </elementProp>
        </HTTPSamplerProxy>
        
        <!-- æ–­è¨€ -->
        <ResultCollector guiclass="ResultCollector" testclass="ResultCollector" testname="ç»“æœæ”¶é›†">
          <boolProp name="ResultCollector.error_logging">true</boolProp>
          <objProp>
            <name>saveConfig</name>
            <value class="SampleSaveConfiguration">
              <time>true</time>
              <latency>true</latency>
              <timestamp>true</timestamp>
              <success>true</success>
              <label>true</label>
              <code>true</code>
              <message>true</message>
              <threadName>true</threadName>
              <dataType>true</dataType>
              <encoding>false</encoding>
            </value>
          </objProp>
          <stringProp name="filename">login_test_results.jtl</stringProp>
        </ResultCollector>
      </ThreadGroup>
    </TestPlan>
  </hashTree>
</jmeterTestPlan>
```

### 9.3 æ€§èƒ½æµ‹è¯•æ‰§è¡Œ

#### 9.3.1 æµ‹è¯•æ‰§è¡Œæµç¨‹

```mermaid
graph TD
    A[å‡†å¤‡æµ‹è¯•ç¯å¢ƒ] --> B[å‡†å¤‡æµ‹è¯•æ•°æ®]
    B --> C[é…ç½®æµ‹è¯•å·¥å…·]
    C --> D[æ‰§è¡Œæ€§èƒ½æµ‹è¯•]
    D --> E[æ”¶é›†æµ‹è¯•ç»“æœ]
    E --> F[åˆ†ææµ‹è¯•ç»“æœ]
    F --> G[ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š]
    G --> H[è¯„ä¼°æ€§èƒ½æŒ‡æ ‡]
    H --> I{æ€§èƒ½è¾¾æ ‡?}
    I -->|æ˜¯| J[æµ‹è¯•å®Œæˆ]
    I -->|å¦| K[æ€§èƒ½ä¼˜åŒ–]
    K --> D
```

#### 9.3.2 æµ‹è¯•æ‰§è¡Œè„šæœ¬

**Locustæµ‹è¯•æ‰§è¡Œ**ï¼š
```bash
#!/bin/bash

# run_performance_test.sh

# 1. å‡†å¤‡æµ‹è¯•ç¯å¢ƒ
echo "å‡†å¤‡æµ‹è¯•ç¯å¢ƒ..."
python tests/performance/prepare_data.py

# 2. æ‰§è¡Œç”¨æˆ·ç™»å½•æµ‹è¯•
echo "æ‰§è¡Œç”¨æˆ·ç™»å½•æµ‹è¯•..."
locust -f tests/performance/locustfile.py \
  --host http://localhost:8000 \
  --users 100 \
  --spawn-rate 10 \
  --run-time 5m \
  --headless \
  --csv login_test_results

# 3. æ‰§è¡Œç”¨æˆ·æŸ¥è¯¢æµ‹è¯•
echo "æ‰§è¡Œç”¨æˆ·æŸ¥è¯¢æµ‹è¯•..."
locust -f tests/performance/locustfile.py \
  --host http://localhost:8000 \
  --users 200 \
  --spawn-rate 20 \
  --run-time 5m \
  --headless \
  --csv user_query_test_results

# 4. æ‰§è¡Œå·¥ä½œæµå®¡æ‰¹æµ‹è¯•
echo "æ‰§è¡Œå·¥ä½œæµå®¡æ‰¹æµ‹è¯•..."
locust -f tests/performance/locustfile.py \
  --host http://localhost:8000 \
  --users 50 \
  --spawn-rate 5 \
  --run-time 5m \
  --headless \
  --csv workflow_test_results

# 5. ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
echo "ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š..."
python tests/performance/generate_report.py

echo "æ€§èƒ½æµ‹è¯•å®Œæˆï¼"
```

#### 9.3.3 æµ‹è¯•ç»“æœæ”¶é›†

**æµ‹è¯•ç»“æœæ”¶é›†è„šæœ¬**ï¼š
```python
# tests/performance/collect_results.py
import pandas as pd
import json
from datetime import datetime

def collect_locust_results(csv_file: str):
    """æ”¶é›†Locustæµ‹è¯•ç»“æœ"""
    df = pd.read_csv(csv_file)
    
    # è®¡ç®—å…³é”®æŒ‡æ ‡
    results = {
        "total_requests": len(df),
        "success_requests": len(df[df['success'] == True]),
        "failed_requests": len(df[df['success'] == False]),
        "success_rate": (len(df[df['success'] == True]) / len(df)) * 100,
        "avg_response_time": df['response_time'].mean(),
        "min_response_time": df['response_time'].min(),
        "max_response_time": df['response_time'].max(),
        "p50_response_time": df['response_time'].quantile(0.5),
        "p95_response_time": df['response_time'].quantile(0.95),
        "p99_response_time": df['response_time'].quantile(0.99),
        "rps": len(df) / (df['timestamp'].max() - df['timestamp'].min())
    }
    
    return results

# ä½¿ç”¨ç¤ºä¾‹
login_results = collect_locust_results("login_test_results_stats.csv")
print(json.dumps(login_results, indent=2, ensure_ascii=False))
```

### 9.4 æ€§èƒ½æµ‹è¯•æŠ¥å‘Š

#### 9.4.1 æµ‹è¯•ç»“æœæŠ¥å‘Š

**æŠ¥å‘Šæ¨¡æ¿**ï¼š
```markdown
# æ€§èƒ½æµ‹è¯•æŠ¥å‘Š

## 1. æµ‹è¯•æ¦‚è¿°

- **æµ‹è¯•æ—¶é—´**ï¼š2024-01-15
- **æµ‹è¯•ç¯å¢ƒ**ï¼šStaging
- **æµ‹è¯•å·¥å…·**ï¼šLocust + JMeter
- **æµ‹è¯•äººå‘˜**ï¼šæ€§èƒ½æµ‹è¯•å›¢é˜Ÿ

## 2. æµ‹è¯•åœºæ™¯

| åœºæ™¯ | å¹¶å‘ç”¨æˆ· | ç›®æ ‡TPS | ç›®æ ‡å“åº”æ—¶é—´(P95) |
|-----|---------|---------|-----------------|
| ç”¨æˆ·ç™»å½• | 100 | 100 | 200ms |
| ç”¨æˆ·æŸ¥è¯¢ | 200 | 500 | 100ms |
| å·¥ä½œæµå®¡æ‰¹ | 50 | 50 | 300ms |

## 3. æµ‹è¯•ç»“æœ

### 3.1 ç”¨æˆ·ç™»å½•æµ‹è¯•

| æŒ‡æ ‡ | å®é™…å€¼ | ç›®æ ‡å€¼ | ç»“æœ |
|-----|--------|--------|------|
| TPS | 120 | 100 | âœ… é€šè¿‡ |
| P95å“åº”æ—¶é—´ | 180ms | 200ms | âœ… é€šè¿‡ |
| P99å“åº”æ—¶é—´ | 250ms | 500ms | âœ… é€šè¿‡ |
| æˆåŠŸç‡ | 99.5% | 99% | âœ… é€šè¿‡ |

### 3.2 ç”¨æˆ·æŸ¥è¯¢æµ‹è¯•

| æŒ‡æ ‡ | å®é™…å€¼ | ç›®æ ‡å€¼ | ç»“æœ |
|-----|--------|--------|------|
| TPS | 550 | 500 | âœ… é€šè¿‡ |
| P95å“åº”æ—¶é—´ | 90ms | 100ms | âœ… é€šè¿‡ |
| P99å“åº”æ—¶é—´ | 150ms | 500ms | âœ… é€šè¿‡ |
| æˆåŠŸç‡ | 99.8% | 99% | âœ… é€šè¿‡ |

### 3.3 å·¥ä½œæµå®¡æ‰¹æµ‹è¯•

| æŒ‡æ ‡ | å®é™…å€¼ | ç›®æ ‡å€¼ | ç»“æœ |
|-----|--------|--------|------|
| TPS | 45 | 50 | âŒ æœªé€šè¿‡ |
| P95å“åº”æ—¶é—´ | 280ms | 300ms | âœ… é€šè¿‡ |
| P99å“åº”æ—¶é—´ | 350ms | 500ms | âœ… é€šè¿‡ |
| æˆåŠŸç‡ | 98.5% | 99% | âŒ æœªé€šè¿‡ |

## 4. æ€§èƒ½ç“¶é¢ˆåˆ†æ

### 4.1 å·¥ä½œæµå®¡æ‰¹TPSä¸è¶³

**é—®é¢˜**ï¼šå·¥ä½œæµå®¡æ‰¹TPSä¸º45ï¼Œä½äºç›®æ ‡å€¼50

**åˆ†æ**ï¼š
- æ•°æ®åº“æŸ¥è¯¢æ…¢ï¼ˆå¹³å‡å“åº”æ—¶é—´150msï¼‰
- ç¼ºå°‘ç¼“å­˜ï¼ˆæ¯æ¬¡éƒ½æŸ¥è¯¢æ•°æ®åº“ï¼‰
- å¹¶å‘å¤„ç†èƒ½åŠ›ä¸è¶³

**å»ºè®®**ï¼š
1. æ·»åŠ Redisç¼“å­˜
2. ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢
3. å¢åŠ åº”ç”¨æœåŠ¡å™¨æ•°é‡

### 4.2 å·¥ä½œæµå®¡æ‰¹æˆåŠŸç‡ä½

**é—®é¢˜**ï¼šå·¥ä½œæµå®¡æ‰¹æˆåŠŸç‡ä¸º98.5%ï¼Œä½äºç›®æ ‡å€¼99%

**åˆ†æ**ï¼š
- é«˜å¹¶å‘æ—¶å‡ºç°è¶…æ—¶é”™è¯¯
- æ•°æ®åº“è¿æ¥æ± ä¸è¶³
- å¶å‘çš„ç½‘ç»œé—®é¢˜

**å»ºè®®**ï¼š
1. å¢åŠ æ•°æ®åº“è¿æ¥æ± å¤§å°
2. ä¼˜åŒ–è¶…æ—¶å¤„ç†
3. æ·»åŠ é‡è¯•æœºåˆ¶

## 5. ä¼˜åŒ–å»ºè®®

### 5.1 é«˜ä¼˜å…ˆçº§ï¼ˆ1-2å‘¨å†…å®Œæˆï¼‰
1. æ·»åŠ Redisç¼“å­˜
2. ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢
3. å¢åŠ æ•°æ®åº“è¿æ¥æ± å¤§å°

### 5.2 ä¸­ä¼˜å…ˆçº§ï¼ˆ1ä¸ªæœˆå†…å®Œæˆï¼‰
1. å¢åŠ åº”ç”¨æœåŠ¡å™¨æ•°é‡
2. ä¼˜åŒ–è¶…æ—¶å¤„ç†
3. æ·»åŠ é‡è¯•æœºåˆ¶

### 5.3 ä½ä¼˜å…ˆçº§ï¼ˆ3ä¸ªæœˆå†…å®Œæˆï¼‰
1. å®æ–½è¯»å†™åˆ†ç¦»
2. ä¼˜åŒ–æ•°æ®åº“ç´¢å¼•
3. å®æ–½åˆ†åº“åˆ†è¡¨

## 6. æµ‹è¯•ç»“è®º

æœ¬æ¬¡æ€§èƒ½æµ‹è¯•å…±æ‰§è¡Œ3ä¸ªåœºæ™¯ï¼Œå…¶ä¸­2ä¸ªåœºæ™¯é€šè¿‡ï¼Œ1ä¸ªåœºæ™¯æœªé€šè¿‡ã€‚å»ºè®®ä¼˜å…ˆä¼˜åŒ–å·¥ä½œæµå®¡æ‰¹åœºæ™¯çš„æ€§èƒ½ï¼Œç¡®ä¿ç³»ç»Ÿæ€§èƒ½æ»¡è¶³ä¸šåŠ¡éœ€æ±‚ã€‚

## 7. é™„å½•

- æµ‹è¯•å·¥å…·ï¼šLocust + JMeter
- æµ‹è¯•æ—¶é—´ï¼š2024-01-15
- æµ‹è¯•äººå‘˜ï¼šæ€§èƒ½æµ‹è¯•å›¢é˜Ÿ
```

#### 9.4.2 æµ‹è¯•æŠ¥å‘Šç”Ÿæˆ

**è‡ªåŠ¨ç”ŸæˆæŠ¥å‘Š**ï¼š
```python
# tests/performance/generate_report.py
import pandas as pd
import json
from datetime import datetime

def generate_performance_report(test_results: dict):
    """ç”Ÿæˆæ€§èƒ½æµ‹è¯•æŠ¥å‘Š"""
    report = f"""# æ€§èƒ½æµ‹è¯•æŠ¥å‘Š

## 1. æµ‹è¯•æ¦‚è¿°

- **æµ‹è¯•æ—¶é—´**ï¼š{datetime.now().strftime('%Y-%m-%d')}
- **æµ‹è¯•ç¯å¢ƒ**ï¼šStaging
- **æµ‹è¯•å·¥å…·**ï¼šLocust + JMeter
- **æµ‹è¯•äººå‘˜**ï¼šæ€§èƒ½æµ‹è¯•å›¢é˜Ÿ

## 2. æµ‹è¯•åœºæ™¯

| åœºæ™¯ | å¹¶å‘ç”¨æˆ· | ç›®æ ‡TPS | ç›®æ ‡å“åº”æ—¶é—´(P95) |
|-----|---------|---------|-----------------|
"""
    
    # æ·»åŠ æµ‹è¯•åœºæ™¯
    for scenario in test_results['scenarios']:
        report += f"| {scenario['name']} | {scenario['users']} | {scenario['target_tps']} | {scenario['target_response_time']} |\n"
    
    report += "\n## 3. æµ‹è¯•ç»“æœ\n\n"
    
    # æ·»åŠ æµ‹è¯•ç»“æœ
    for result in test_results['results']:
        report += f"### {result['scenario_name']}\n\n"
        report += "| æŒ‡æ ‡ | å®é™…å€¼ | ç›®æ ‡å€¼ | ç»“æœ |\n"
        report += "|-----|--------|--------|------|\n"
        
        for metric in result['metrics']:
            status = "âœ… é€šè¿‡" if metric['passed'] else "âŒ æœªé€šè¿‡"
            report += f"| {metric['name']} | {metric['actual']} | {metric['target']} | {status} |\n"
        
        report += "\n"
    
    report += "## 4. æ€§èƒ½ç“¶é¢ˆåˆ†æ\n\n"
    
    # æ·»åŠ æ€§èƒ½ç“¶é¢ˆ
    for bottleneck in test_results['bottlenecks']:
        report += f"### {bottleneck['scenario_name']}\n\n"
        report += f"**é—®é¢˜**ï¼š{bottleneck['problem']}\n\n"
        report += f"**åˆ†æ**ï¼š{bottleneck['analysis']}\n\n"
        report += f"**å»ºè®®**ï¼š\n\n"
        for suggestion in bottleneck['suggestions']:
            report += f"{suggestion}\n"
        report += "\n"
    
    return report

# ä½¿ç”¨ç¤ºä¾‹
test_results = {
    'scenarios': [
        {
            'name': 'ç”¨æˆ·ç™»å½•',
            'users': 100,
            'target_tps': 100,
            'target_response_time': '200ms'
        }
    ],
    'results': [
        {
            'scenario_name': 'ç”¨æˆ·ç™»å½•',
            'metrics': [
                {
                    'name': 'TPS',
                    'actual': 120,
                    'target': 100,
                    'passed': True
                },
                {
                    'name': 'P95å“åº”æ—¶é—´',
                    'actual': '180ms',
                    'target': '200ms',
                    'passed': True
                }
            ]
        }
    ],
    'bottlenecks': []
}

report = generate_performance_report(test_results)
print(report)
```

### 9.5 æ€§èƒ½æµ‹è¯•æœ€ä½³å®è·µ

**æµ‹è¯•æ‰§è¡Œæœ€ä½³å®è·µ**ï¼š
- âœ… åœ¨ç‹¬ç«‹çš„æµ‹è¯•ç¯å¢ƒæ‰§è¡Œ
- âœ… ä½¿ç”¨çœŸå®çš„æµ‹è¯•æ•°æ®
- âœ… æ¨¡æ‹ŸçœŸå®çš„ç”¨æˆ·è¡Œä¸º
- âœ… ç›‘æ§ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ

**ç»“æœåˆ†ææœ€ä½³å®è·µ**ï¼š
- âœ… å¯¹æ¯”å†å²æµ‹è¯•ç»“æœ
- âœ… åˆ†ææ€§èƒ½ç“¶é¢ˆåŸå› 
- âœ… æä¾›å…·ä½“çš„ä¼˜åŒ–å»ºè®®
- âœ… éªŒè¯ä¼˜åŒ–æ•ˆæœ

**æŠ¥å‘Šç®¡ç†æœ€ä½³å®è·µ**ï¼š
- âœ… åŠæ—¶ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
- âœ… åˆ†å‘ç»™ç›¸å…³äººå‘˜
- âœ… è·Ÿè¸ªä¼˜åŒ–è¿›åº¦
- âœ… å®šæœŸå›é¡¾æµ‹è¯•ç»“æœ

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [æŠ€æœ¯æ¶æ„è®¾è®¡æ–‡æ¡£](./2-æŠ€æœ¯æ¶æ„è®¾è®¡æ–‡æ¡£.md)
- [è¿ç»´æ–‡æ¡£](./10-è¿ç»´æ–‡æ¡£.md)
- [å®‰å…¨æ–‡æ¡£](./11-å®‰å…¨æ–‡æ¡£.md)

---

## ğŸ’¡ æ³¨æ„äº‹é¡¹

1. **æ€§èƒ½æµ‹è¯•**ï¼šå®šæœŸè¿›è¡Œæ€§èƒ½æµ‹è¯•ï¼ŒåŠæ—¶å‘ç°æ€§èƒ½é—®é¢˜
2. **ç›‘æ§å‘Šè­¦**ï¼šé…ç½®æ€§èƒ½ç›‘æ§å‘Šè­¦ï¼ŒåŠæ—¶å‘ç°é—®é¢˜
3. **ä¼˜åŒ–éªŒè¯**ï¼šä¼˜åŒ–åè¿›è¡Œæ€§èƒ½æµ‹è¯•ï¼ŒéªŒè¯ä¼˜åŒ–æ•ˆæœ
4. **æŒç»­ä¼˜åŒ–**ï¼šæ€§èƒ½ä¼˜åŒ–æ˜¯æŒç»­çš„è¿‡ç¨‹ï¼Œéœ€è¦æŒç»­æ”¹è¿›
5. **æ–‡æ¡£æ›´æ–°**ï¼šä¼˜åŒ–ååŠæ—¶æ›´æ–°æ€§èƒ½æ–‡æ¡£

---

**æ–‡æ¡£ç‰ˆæœ¬å†å²**ï¼š

| ç‰ˆæœ¬ | æ—¥æœŸ | ä½œè€… | å˜æ›´è¯´æ˜ |
|-----|------|------|---------|
| v1.0 | 2026-01-13 | AIåŠ©æ‰‹ | åˆå§‹ç‰ˆæœ¬ |
| v1.1 | 2026-01-14 | AIåŠ©æ‰‹ | æ–°å¢æ€§èƒ½æµ‹è¯•åŸºå‡†ç« èŠ‚ |

---